%!PS-Adobe-2.0
%%Creator: dvipsk 5.58f Copyright 1986, 1994 Radical Eye Software
%%Title: kawa-paper.dvi
%%Pages: 13
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%DocumentFonts: Times-Bold Times-Roman Times-Italic Courier
%%DocumentPaperSizes: a4
%%EndComments
%DVIPSCommandLine: dvips -o kawa-paper.ps kawa-paper.dvi
%DVIPSParameters: dpi=600, comments removed
%DVIPSSource:  TeX output 1997.01.20:1418
%%BeginProcSet: tex.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N
/X{S N}B /TR{translate}N /isls false N /vsize 11 72 mul N /hsize 8.5 72
mul N /landplus90{false}def /@rigin{isls{[0 landplus90{1 -1}{-1 1}
ifelse 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
isls{landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div
hsize mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul
TR[matrix currentmatrix{dup dup round sub abs 0.00001 lt{round}if}
forall round exch round exch]setmatrix}N /@landscape{/isls true N}B
/@manualfeed{statusdict /manualfeed true put}B /@copies{/#copies X}B
/FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{
/nn 8 dict N nn begin /FontType 3 N /FontMatrix fntrx N /FontBBox FBB N
string /base X array /BitMaps X /BuildChar{CharBuilder}N /Encoding IE N
end dup{/foo setfont}2 array copy cvx N load 0 nn put /ctr 0 N[}B /df{
/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]
N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data dup
length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{
128 ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub
get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data
dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N
/rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup
/base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx
0 ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff
setcachedevice ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff
.1 sub]{ch-image}imagemask restore}B /D{/cc X dup type /stringtype ne{]}
if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1 ne{dup dup
length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}B /I{
cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul
add .99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore userdict
/eop-hook known{eop-hook}if showpage}N /@start{userdict /start-hook
known{start-hook}if pop /VResolution X /Resolution X 1000 div /DVImag X
/IE 256 array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for
65781.76 div /vsize X 65781.76 div /hsize X}N /p{show}N /RMat[1 0 0 -1 0
0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X /rulex X V}B /V
{}B /RV statusdict begin /product where{pop product dup length 7 ge{0 7
getinterval dup(Display)eq exch 0 4 getinterval(NeXT)eq or}{pop false}
ifelse}{false}ifelse end{{gsave TR -.1 .1 TR 1 1 scale rulex ruley false
RMat{BDot}imagemask grestore}}{{gsave TR -.1 .1 TR rulex ruley scale 1 1
false RMat{BDot}imagemask grestore}}ifelse B /QV{gsave newpath transform
round exch round exch itransform moveto rulex 0 rlineto 0 ruley neg
rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N /tail
{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}
B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{
4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{
p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p
a}B /bos{/SS save N}B /eos{SS restore}B end
%%EndProcSet
%%BeginFont: Times-Bold
% @@psencodingfile@{
%   author = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry",
%   version = "0.6",
%   date = "22 June 1996",
%   filename = "8r.enc",
%   email = "kb@@mail.tug.org",
%   address = "135 Center Hill Rd. // Plymouth, MA 02360",
%   codetable = "ISO/ASCII",
%   checksum = "119     662    4424",
%   docstring = "Encoding for TrueType or Type 1 fonts to be used with TeX."
% @}
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both ASCII and Windows.
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there down to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def
%%EndFont
%%BeginProcSet: texps.pro
TeXDict begin /rf{findfont dup length 1 add dict begin{1 index /FID ne 2
index /UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type /integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics /Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont /setfont load]cvx def}def
/ObliqueSlant{dup sin S cos div neg}B /SlantFont{4 index mul add}def
/ExtendFont{3 -1 roll mul exch}def /ReEncodeFont{/Encoding exch def}def
end
%%EndProcSet
TeXDict begin 39158280 55380996 1000 600 600 (kawa-paper.dvi)
@start /Fa 143[45 2[45 37[45 71[{ TeXBase1Encoding ReEncodeFont }3
75.000000 /Courier rf /Fb 1 53 df<0000E00001E00001E00003E00007E00007E000
0DE0001DE00039E00031E00061E000E1E000C1E00181E00381E00701E00601E00C01E01C
01E01801E03001E07001E0E001E0FFFFFFFFFFFF0001E00001E00001E00001E00001E000
01E00003F0003FFF003FFF18227DA11E>52 D E /Fc 105[37 27[29
33 1[50 33 37 21 29 29 1[37 37 37 54 21 33 21 21 37 37
21 33 37 33 37 37 10[46 54 42 37 2[46 54 50 62 42 1[33
25 1[54 46 46 54 50 1[46 6[25 37 37 37 5[37 3[25 3[25
25 37[37 2[{ TeXBase1Encoding ReEncodeFont }51 75.000000
/Times-Italic rf /Fd 105[37 27[33 37 1[54 37 37 21 29
25 37 37 37 37 58 21 2[21 37 37 25 33 37 33 37 33 3[25
1[25 1[54 1[71 1[54 46 42 50 1[42 54 54 66 46 1[29 25
54 54 42 46 54 50 50 54 6[21 37 37 37 37 37 37 37 37
37 37 21 19 25 19 42 1[25 25 25 39[{ TeXBase1Encoding ReEncodeFont }66
75.000000 /Times-Roman rf /Fe 144[60 60 6[60 1[60 60
60 99[{ TeXBase1Encoding ReEncodeFont }6 100.000000 /Courier
rf /Ff 134[40 3[40 40 40 40 1[40 40 40 40 4[40 40 40
40 1[40 40 16[40 22[40 10[40 40 46[{ TeXBase1Encoding ReEncodeFont }19
66.666664 /Courier rf /Fg 105[33 28[33 33 48 1[33 18
26 22 1[33 33 33 52 18 2[18 33 33 22 29 33 2[29 3[22
1[22 13[59 27[33 2[17 22 45[{ TeXBase1Encoding ReEncodeFont }26
66.666664 /Times-Roman rf /Fh 206[25 49[{
 TeXBase1Encoding ReEncodeFont }1 50.000000 /Times-Roman
rf /Fi 206[29 49[{ TeXBase1Encoding ReEncodeFont }1 58.333336
/Times-Roman rf /Fj 4 53 df<0003F80000001FFF0000007E0FC00000F803E00001E0
00F00003C000780007C0007C000F80003E000F80003E001F00001F001F00001F003F0000
1F803F00001F803F00001F807E00000FC07E00000FC07E00000FC07E00000FC07E00000F
C07E00000FC0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0
FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE
00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE0FE00000FE07E00000FC07E00
000FC07E00000FC07E00000FC07F00001FC03F00001F803F00001F803F00001F801F0000
1F001F80003F000F80003E000F80003E0007C0007C0003E000F80001F001F00000F803E0
00007E0FC000001FFF00000003F80000233A7DB72A>48 D<0001C0000003C0000007C000
001FC00000FFC000FFFFC000FFFFC000FF1FC000001FC000001FC000001FC000001FC000
001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000
001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000
001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000
001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000001FC000
001FC000001FC000001FC000001FC000003FE0007FFFFFF07FFFFFF07FFFFFF01C3879B7
2A>I<000FF00000007FFE000001FFFF800003E03FE0000F000FF0000E0007F8001C0003
FC00380001FE00300001FE00700000FF00600000FF00FC0000FF00FF00007F80FF80007F
80FF80007F80FF80007F80FF80007F80FF80007F807F00007F801C00007F800000007F80
000000FF00000000FF00000000FF00000001FE00000001FC00000003FC00000003F80000
0007F000000007E00000000FE00000001FC00000003F800000003F000000007C00000000
F800000001F000000003E000000007C00000000F800000000F000000001E000180003C00
0180007800018000F000038001E000030003C000030007800003000E000007000FFFFFFF
001FFFFFFF003FFFFFFF007FFFFFFE00FFFFFFFE00FFFFFFFE00FFFFFFFE0021387CB72A
>I<000000380000000038000000007800000000F800000000F800000001F800000003F8
00000007F800000007F80000000FF80000001FF80000001BF800000033F800000073F800
000063F8000000C3F8000001C3F800000183F800000303F800000703F800000603F80000
0C03F800001C03F800001803F800003003F800007003F800006003F80000C003F80001C0
03F800038003F800030003F800070003F8000E0003F8000C0003F800180003F800380003
F800300003F800600003F800E00003F800FFFFFFFFF8FFFFFFFFF8FFFFFFFFF8000003F8
00000003F800000003F800000003F800000003F800000003F800000003F800000003F800
000003F800000003F800000003F800000007FC000003FFFFF80003FFFFF80003FFFFF825
397EB82A>52 D E /Fk 2 16 df<7FFFFFFFFFFF80FFFFFFFFFFFFC0FFFFFFFFFFFFC07F
FFFFFFFFFF803204799641>0 D<000FE000007FFC0000FFFE0003FFFF8007FFFFC00FFF
FFE01FFFFFF03FFFFFF83FFFFFF87FFFFFFC7FFFFFFC7FFFFFFCFFFFFFFEFFFFFFFEFFFF
FFFEFFFFFFFEFFFFFFFEFFFFFFFEFFFFFFFEFFFFFFFE7FFFFFFC7FFFFFFC7FFFFFFC3FFF
FFF83FFFFFF81FFFFFF00FFFFFE007FFFFC003FFFF8000FFFE00007FFC00000FE0001F20
7BA42A>15 D E /Fl 103[50 26[50 1[50 50 50 50 50 50 50
50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50
50 50 1[50 1[50 1[50 3[50 50 50 50 50 50 50 50 50 50
50 50 2[50 2[50 50 50 50 50 50 50 1[50 50 50 50 50 4[50
50 50 50 50 50 50 50 50 50 50 50 50 50 50 3[50 50 50
33[{ TeXBase1Encoding ReEncodeFont }75 83.333336 /Courier
rf /Fm 134[42 42 1[42 46 28 32 37 46 46 42 46 69 23 2[23
46 42 28 37 46 37 46 42 9[83 60 60 55 46 60 65 51 1[60
78 55 2[32 2[51 55 60 60 55 60 6[28 8[42 46[46 2[{
 TeXBase1Encoding ReEncodeFont }43 83.333336 /Times-Bold
rf /Fn 107[37 37 24[37 42 42 60 42 42 23 32 28 42 42
42 42 65 23 42 23 23 42 42 28 37 42 37 42 37 3[28 1[28
1[60 1[78 1[60 51 46 55 60 46 60 60 74 51 60 32 28 60
60 46 51 60 55 55 60 1[37 3[23 23 42 42 42 42 42 42 42
42 42 42 23 21 28 21 47 1[28 28 28 5[28 29[46 46 2[{
 TeXBase1Encoding ReEncodeFont }77 83.333336 /Times-Roman
rf /Fo 107[46 46 24[32 37 1[55 37 42 23 32 32 42 42 42
42 60 23 37 23 23 42 42 23 37 42 37 42 42 8[51 2[60 46
42 51 2[60 2[46 55 37 28 3[51 1[55 8[28 11[21 28 21 40[42
42 2[{ TeXBase1Encoding ReEncodeFont }45 83.333336 /Times-Italic
rf /Fp 134[50 50 72 50 55 33 39 44 1[55 50 55 83 28 55
33 28 55 50 33 44 55 44 55 50 9[100 72 1[66 55 72 78
61 78 72 94 66 2[39 2[61 66 1[72 66 72 7[50 50 50 50
50 50 50 50 50 50 1[25 33 25 44[{ TeXBase1Encoding ReEncodeFont }54
100.000000 /Times-Bold rf /Fq 134[44 3[50 28 39 3[50
50 1[28 2[28 1[50 19[50 15[66 67[{ TeXBase1Encoding ReEncodeFont }11
100.000000 /Times-Italic rf /Fr 139[28 1[33 2[50 50 5[50
2[44 20[55 13[66 66[{ TeXBase1Encoding ReEncodeFont }8
100.000000 /Times-Roman rf /Fs 136[86 60 1[40 3[66 60
66 100 33 2[33 66 60 1[53 1[53 1[60 13[66 7[93 60 6[86
8[40 58[{ TeXBase1Encoding ReEncodeFont }19 119.999947
/Times-Bold rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%PaperSize: a4

%%EndSetup
%%Page: 1 1
1 0 bop 1086 814 a Fs(Kawa:)37 b(Compiling)31 b(Scheme)f(to)g(J)n(a)m
(v)o(a)1711 1130 y Fr(Per)25 b(Bothner)1580 1296 y Fq(Cygnus)g
(Solutions)730 1580 y Fp(Abstract)100 1803 y Fo(Kawa)c(is)h(an)e
(implementation)g(of)h(the)g(Sc)o(heme)f(pr)l(o)o(gr)o(am-)0
1903 y(ming)35 b(langua)o(g)o(e)e(written)j(entir)m(ely)f(in)h(J)m
(ava.)69 b(It)36 b(compiles)0 2003 y(Sc)o(heme)28 b(pr)l(ocedur)m(es)h
(into)h(J)m(ava)f(bytecode)f(classes,)k(either)0 2102
y(on-the-\003y)-5 b(,)28 b(or)g(in)g(batc)o(h)f(mode)g(for)h(later)g
(use)o(.)48 b(Kawa)29 b(also)0 2202 y(includes)21 b(a)g(full)h(Sc)o
(heme)f(run-time)g(en)m(vir)l(onment)f(written)i(in)0
2301 y(an)g(object-oriented)e(style)o(,)j(with)g(class)g(hier)o(ar)m(c)
o(hies)e(for)i(col-)0 2401 y(lections,)d(pr)l(ocedur)m(es,)f(and)g(the)
h(full)h(numeric)f(\223tower)-9 b(.)d(\224)100 2525 y(This)43
b(paper)f(gives)h(an)g(o)o(vervie)o(w)g(of)g(the)g(featur)m(es)f(of)0
2625 y(Kawa.)102 b(It)46 b(concentr)o(ates)f(on)g(the)h(compiler)-9
b(,)52 b(and)45 b(how)0 2724 y(Sc)o(heme)31 b(values)h(ar)m(e)h(r)m
(epr)m(esented)e(by)i(J)m(ava)e(objects.)61 b(The)0 2824
y(paper)18 b(is)h(structur)m(ed)f(as)h(a)f(\223tour\224)h(of)g(the)f(J)
m(ava)g(classes)h(used)0 2923 y(in)h(the)h(implementation.)0
3328 y Fp(1.)99 b(Intr)n(oduction)100 3600 y Fn(While)31
b(Ja)n(v)n(a)h(is)f(a)h(decent)e(programming)e(language,)k(its)0
3699 y(success)23 b(is)h(lar)o(gely)d(due)i(to)g(using)f(portable)f
(bytecodes,)h(and)0 3799 y(its)27 b(inte)o(gration)e(into)g(secure)h
(web)g(bro)n(wsers.)43 b(Man)o(y)25 b(prefer)0 3899 y(other)18
b(programming)e(languages.)23 b(If)18 b(the)o(y)h(are)f(implemented)0
3998 y(on)d(top)g(of)g(Ja)n(v)n(a,)i(programmers)12 b(can)j(gain)g(man)
o(y)f(of)h(the)h(e)o(xtra-)0 4098 y(linguistic)24 b(bene\002ts)g(of)g
(Ja)n(v)n(a,)h(including)d(libraries,)j(portable)0 4198
y(bytecodes,)f(web)h(applets,)h(and)e(the)h(e)o(xisting)f(ef)n(forts)g
(to)h(im-)0 4297 y(pro)o(v)o(e)18 b(Ja)n(v)n(a)j(implementations)d(and)
i(tools.)100 4421 y(Scheme)35 b(is)i(a)f(simple)g(yet)g(po)n(werful)e
(language.)70 b(It)37 b(is)0 4521 y(a)32 b(non-pure)d(functional)h
(language)g(\()p Fo(i.e)o(.)59 b Fn(it)33 b(has)f(\002rst-class)0
4620 y(functions,)46 b(le)o(xical)41 b(scoping,)46 b(non-lazy)40
b(e)n(v)n(aluation,)45 b(and)0 4720 y(side)31 b(ef)n(fects\).)56
b(It)30 b(has)h(dynamic)e(typing,)j(and)e(usually)g(has)0
4820 y(an)37 b(interacti)n(v)o(e)f(read-e)n(v)n(aluate-print)d(interf)o
(ace.)75 b(The)36 b(dy-)0 4919 y(namic)30 b(nature)g(of)h(Scheme)f
(\(run-time)f(typing,)i(immediate)0 5019 y(e)o(xpression)f(e)n(v)n
(aluation\))g(may)h(be)h(a)g(better)f(match)g(for)h(the)0
5118 y(dynamic)24 b(Ja)n(v)n(a)i(en)m(vironment)d(\(interpreted)h
(bytecodes,)h(dy-)0 5218 y(namic)20 b(loading\))e(than)i(Ja)n(v)n(a)g
(is!)100 5342 y Fm(Note:)84 b Fn(Ka)o(w)o(a)51 b(is)g(also)g(the)f
(trademark)o(ed)e(name)i(of)0 5442 y(a)f(commercial)f(Ja)n(v)n(a)h(de)n
(v)o(elopment)d(en)m(vironment.)107 b(T)-7 b(o)0 5541
y(a)n(v)n(oid)38 b(confusion,)j(we)e(may)g(soon)f(change)f(the)i(name)f
(of)0 5641 y(the)33 b(system)g(described)f(here,)j(b)n(ut)e(in)g(an)o
(y)f(case,)37 b(informa-)0 5740 y(tion)f(and)f(source)h(code)f(will)i
(be)f(a)n(v)n(ailable)g(from)f Fl(http:)0 5840 y
(//www.cygnus.com/\230bothner/kawa.html)o Fn(.)2070 1580
y Fp(2.)99 b(Backgr)n(ound)2170 1782 y Fn(Starting)19
b(in)g(1995)f(Cygnus)h(\(on)g(behalf)g(of)g(the)g(Free)h(Soft-)2070
1882 y(w)o(are)k(F)o(oundation\))d(de)n(v)o(eloped)g(Guile,)j(an)g
(implementation)2070 1981 y(of)36 b(Scheme)g(suitable)g(as)h(a)g
(general)e(embedding)f(and)i(e)o(x-)2070 2081 y(tension)25
b(language.)38 b(Guile)25 b(w)o(as)h(based)f(on)g(Aubre)o(y)f(Jaf)n(f)o
(ar')-5 b(s)2070 2180 y(SCM)21 b(interpreter;)e(the)i(v)n(arious)e
(Guile)h(enhancements)f(were)2070 2280 y(initially)30
b(done)e(by)h(T)-7 b(om)30 b(Lord.)52 b(In)30 b(1995)e(we)i(got)f(a)h
(major)2070 2380 y(contract)16 b(to)i(enhance)e(Guile,)i(and)f(with)h
(our)e(client)i(we)g(added)2070 2479 y(more)d(features,)g(including)e
(threads)i(\(primarily)f(done)g(by)h(An-)2070 2579 y(thon)o(y)k
(Green\),)g(and)g(internationalization.)2170 2680 y(The)39
b(contract)g(called)h(for)f(a)h(byte-code)e(compiler)g(for)2070
2779 y(Guile,)18 b(and)f(it)i(look)o(ed)d(lik)o(e)i(doing)f(a)h(good)e
(job)i(on)f(this)h(w)o(ould)2070 2879 y(be)f(a)g(major)f(project.)23
b(One)17 b(option)e(we)j(considered)d(w)o(as)i(com-)2070
2978 y(piling)22 b(Scheme)g(into)g(Ja)n(v)n(a)h(bytecodes)e(and)h(e)o
(x)o(ecuting)f(them)2070 3078 y(by)g(a)g(Ja)n(v)n(a)h(engine.)k(The)21
b(disadv)n(antage)e(w)o(ould)i(be)g(that)g(such)2070
3178 y(a)f(Scheme)f(system)h(w)o(ould)f(not)g(co-e)o(xist)f(with)i
(Guile)g(\(on)f(the)2070 3277 y(other)j(hand,)f(we)i(had)f(run)f(into)h
(v)n(arious)f(technical)h(and)g(non-)2070 3377 y(technical)27
b(problems)f(with)i(Guile)f(that)h(led)g(us)g(to)f(conclude)2070
3477 y(that)g(Guile)g(w)o(ould)f(after)h(all)h(not)e(be)h(strate)o(gic)
g(to)g(Cygnus\).)2070 3576 y(The)19 b(adv)n(antage)e(of)i(a)g(Ja)n(v)n
(a)h(solution)e(w)o(as)i(le)n(v)o(eraging)d(of)n(f)i(the)2070
3676 y(tools)k(and)f(de)n(v)o(elopment)f(being)h(done)g(in)h(the)g(Ja)n
(v)n(a)g(\223space\224,)2070 3775 y(plus)18 b(that)g(Ja)n(v)n(a)g(w)o
(as)g(more)f(lik)o(ely)h(to)g(be)f(strate)o(gic)h(long-term.)2170
3876 y(The)j(customer)f(agreed)g(to)h(using)g(Ja)n(v)n(a,)g(and)g(I)h
(started)f(ac-)2070 3976 y(ti)n(v)o(e)g(de)n(v)o(elopment)e(June)i
(1996.)28 b(Ka)o(w)o(a)21 b(1.0)g(w)o(as)h(released)f(to)2070
4075 y(our)f(customer)f(and)h(\223the)g(Net\224)h(September)e(1996.)24
b(De)n(v)o(elop-)2070 4175 y(ment)j(has)h(continued)e(since)h(then,)i
(at)f(a)g(less)h(intense)e(pace!)2070 4275 y(The)i(long-term)e(goal)h
(is)i(an)f(object-oriented)e(en)m(vironment)2070 4374
y(that)j(harmoniously)d(inte)o(grates)j(Scheme,)h(Ja)n(v)n(a,)i(and)c
(other)2070 4474 y(languages.)2170 4574 y(As)21 b(a)g(base,)f(I)h(used)
g(the)f(Ka)o(w)o(a)h(Scheme)f(interpreter)f(writ-)2070
4674 y(ten)28 b(by)f(R.)i(Ale)o(xander)d(Milo)n(wski.)47
b(He)28 b(needed)f(an)g(object-)2070 4774 y(oriented)e(Scheme)h
(interpreter)f(to)i(implement)e(DSSSL)i([9],)2070 4873
y(a)35 b(Scheme-lik)o(e)d(en)m(vironment)f(for)j(e)o(xpressing)e
(style,)38 b(for)n(-)2070 4973 y(matting,)18 b(and)g(other)f
(processing)g(of)h(SGML)h([8)o(])g(documents.)2070 5072
y(DSSSL)29 b(is)g(an)f(subset)g(of)g(\223pure\224)f(Scheme)h(with)g
(some)g(e)o(x-)2070 5172 y(tensions.)f(Ka)o(w)o(a)21
b(0.2)f(w)o(as)i(a)f(simple)g(interpreter)e(which)i(w)o(as)2070
5272 y(f)o(ar)26 b(from)e(complete.)41 b(It)26 b(pro)o(vided)e(a)i
(useful)f(starting)h(point,)2070 5371 y(b)n(ut)c(almost)h(all)g(of)f
(the)g(original)f(code)h(has)g(by)g(no)n(w)g(been)g(re-)2070
5471 y(written.)2170 5572 y(There)c(are)g(three)h(basic)g(w)o(ays)g(of)
f(implementing)f(Scheme)2070 5671 y(in)j(Ja)n(v)n(a.)2132
5840 y(1.)41 b(One)20 b(could)e(write)i(an)g(interpreter)e(in)i(Ja)n(v)
n(a,)f(b)n(ut)h(this)g(has)p eop
%%Page: 2 2
2 1 bop 166 523 a Fn(poor)19 b(performance.)62 690 y(2.)41
b(One)26 b(could)g(translate)g(into)g(Ja)n(v)n(a)h(source)e(code.)43
b(Ho)n(w-)166 789 y(e)n(v)o(er)m(,)17 b(in)m(v)n(oking)e(an)j(e)o
(xternal)f(Ja)n(v)n(a)h(source-to-bytecode)166 889 y(compiler)h(is)h
(too)g(slo)n(w)g(e)o(xcept)f(for)g(batch)h(compilation.)166
989 y(Also,)39 b(some)c(features)g(of)g(Ja)n(v)n(a)g(bytecodes)f
(\(such)h(as)166 1088 y(goto\))19 b(are)h(not)g(a)n(v)n(ailable)g(in)g
(the)g(Ja)n(v)n(a)h(language.)62 1255 y(3.)41 b(One)e(could)g
(translate)g(into)g(Ja)n(v)n(a)h(bytecodes,)j(either)166
1355 y(ahead)26 b(of)g(time)h(\(a)f(batch)g(compiler\),)g(or)h(for)f
(immedi-)166 1454 y(ate)21 b(e)o(x)o(ecution.)100 1621
y(W)-7 b(e)43 b(ha)n(v)o(e)e(implemented)f(the)h(last)i(option)e(for)g
(Ka)o(w)o(a,)0 1721 y(partly)17 b(because)g(that)h(w)o(as)g(what)g(our)
f(contract)f(called)i(for)m(,)f(b)n(ut)0 1820 y(also)28
b(because)e(it)j(is)f(the)f(best)h(solution.)46 b(T)-7
b(o)27 b(generate)f(byte-)0 1920 y(codes,)34 b(we)f(use)f(a)g(ne)n(w)g
(\223)p Fl(codegen)p Fn(\224)f(package,)i(which)f(is)0
2019 y(an)18 b(intermediate-le)n(v)o(el)e(toolkit)h(to)i(generate)d(Ja)
n(v)n(a)j(bytecodes)0 2119 y(and)h(\224)p Fl(.class)p
Fn(\224)f(\002les.)100 2219 y(W)-7 b(e)26 b(will)g(discuss)f(the)g
(compiler)f(later)m(,)i(b)n(ut)f(\002rst)g(we)h(will)0
2318 y(gi)n(v)o(e)18 b(an)g(o)o(v)o(ervie)n(w)f(of)h(the)h(run-time)e
(en)m(vironment)e(of)k(Ka)o(w)o(a,)0 2418 y(and)h(the)g(classes)h(used)
f(to)g(implement)f(Scheme)h(v)n(alues.)0 2651 y Fp(3.)99
b(Objects)26 b(and)f(V)-9 b(alues)100 2851 y Fn(Ja)n(v)n(a)34
b([5)o(])h(has)f(primiti)n(v)o(e)f(types)h(\(such)g(as)h(32-bit)e
Fl(int)p Fn(\))0 2950 y(as)e(well)f(reference)e(types.)55
b(If)29 b(a)i(v)n(ariable)e(has)h(a)g(reference)0 3050
y(type,)35 b(it)f(means)e(that)h(it)g(can)g(contains)f(references)f
(\(essen-)0 3150 y(tially)39 b(pointers\))f(to)g(objects)h(of)g(a)g
(class,)44 b(or)38 b(it)i(can)e(con-)0 3249 y(tain)28
b(references)e(to)i(objects)g(of)f(classes)i(that)f(\223e)o(xtend\224)e
(\(in-)0 3349 y(herit)36 b(from\))f(the)i(named)e(class.)75
b(The)36 b(inheritance)f(graph)0 3449 y(is)51 b(\223rooted\224)e(\(lik)
o(e)i(Smalltalk)f(and)g(unlik)o(e)g(C++\);)66 b(this)0
3548 y(means)19 b(that)h(all)g(classes)g(inherit)f(from)g(a)h
(distinguished)e(class)0 3648 y Fl(java.lang.Object)g
Fn(\(or)h(just)i Fl(Object)f Fn(for)f(short\).)100 3748
y(Standard)26 b(Scheme)i([4)o(])g(has)g(a)g(\002x)o(ed)g(set)g(of)g
(types,)h(with)0 3847 y(no)d(w)o(ay)g(of)h(creating)e(ne)n(w)h(types.)
44 b(It)26 b(has)h(run-time)e(typing,)0 3947 y(which)19
b(means)h(that)g(types)f(are)h(not)g(declared,)e(and)h(a)i(v)n(ariable)
0 4047 y(can)i(contain)f(v)n(alues)g(of)h(dif)n(ferent)e(types)i(at)g
(dif)n(ferent)e(times.)0 4146 y(The)k(most)h(natural)f(type)g(of)h(a)g
(Ja)n(v)n(a)g(v)n(ariable)f(that)h(can)f(con-)0 4246
y(tain)33 b(an)o(y)f(Scheme)g(v)n(alue)g(is)h(therefore)e
Fl(Object)p Fn(,)k(and)d(all)0 4345 y(Scheme)23 b(v)n(alues)g(must)g
(be)g(implemented)f(using)g(some)i(class)0 4445 y(that)c(inherits)g
(from)f Fl(Object)p Fn(.)100 4545 y(The)32 b(task)i(then)f(is)h(to)f
(map)g(each)g(Scheme)f(type)h(into)g(a)0 4644 y(Ja)n(v)n(a)25
b(class.)39 b(Whether)24 b(to)g(use)h(a)g(standard)e(Ja)n(v)n(a)i
(class,)h(or)e(to)0 4744 y(write)19 b(our)f(o)n(wn)g(is)i(a)f(tradeof)n
(f.)k(Using)c(standard)e(Ja)n(v)n(a)i(classes)0 4844
y(simpli\002es)k(the)g(passing)f(of)h(v)n(alues)f(between)g(Scheme)g
(func-)0 4943 y(tions)32 b(and)f(e)o(xisting)g(Ja)n(v)n(a)h(methods.)58
b(On)31 b(the)h(other)f(hand,)0 5043 y(e)n(v)o(en)24
b(when)g(Ja)n(v)n(a)i(has)f(suitable)f(b)n(uilt-in)h(classes,)i(the)o
(y)d(usu-)0 5143 y(ally)17 b(lack)f(functionality)f(needed)g(for)h
(Scheme,)h(or)f(are)h(not)f(or)n(-)0 5242 y(ganized)f(in)j(an)o(y)e
(kind)g(of)h(class)h(hierarchy)d(as)j(in)f(Smalltalk)g(or)0
5342 y(Dylan.)24 b(Since)18 b(Ja)n(v)n(a)h(lacks)g(standard)e(classes)j
(corresponding)0 5442 y(to)e(pairs,)g(symbols,)g(or)f(procedures,)f(we)
i Fo(have)g Fn(to)g(write)g(some)0 5541 y(ne)n(w)35 b(classes,)41
b(so)35 b(we)h(might)f(as)h(well)g(write)g(ne)n(w)f(classes)0
5641 y(whene)n(v)o(er)27 b(the)i(e)o(xisting)f(classes)j(lack)e
(functionality)-5 b(.)49 b(One)0 5740 y(e)o(xtreme)33
b(w)o(ould)g(be)g(to)h(de\002ne)f(a)i(ne)n(w)e Fl(SchemeObject)0
5840 y Fn(class,)24 b(and)f(deri)n(v)o(e)e(from)h(it)i(classes)g(for)e
(all)i(Scheme)e(v)n(alues.)2070 523 y(While)33 b(this)g(might)f(mak)o
(e)g(implementing)f(Scheme)h(easier)m(,)2070 623 y(Ka)o(w)o(a)17
b(does)h(not)f(go)g(that)g(f)o(ar)m(,)g(partly)g(because)g(we)g(w)o
(ant)h(to)f(al-)2070 722 y(lo)n(w)j(Scheme)g(v)n(ariables)f(to)i
(contain)e(arbitrary)f(Ja)n(v)n(a)j(objects.)2170 822
y(The)64 b(Scheme)g(boolean)g(type)g(is)i(one)e(where)g(we)2070
922 y(use)51 b(a)g(standard)f(Ja)n(v)n(a)h(type,)57 b(in)51
b(this)g(case)g Fl(Boolean)2070 1021 y Fn(\(strictly)57
b(speaking)f Fl(java.lang.Boolean)p Fn(\).)133 b(The)2070
1121 y(Scheme)33 b(constants)f Fl(#f)i Fn(and)f Fl(#t)g
Fn(are)g(mapped)f(into)h(static)2070 1221 y(\002elds)h(\(i.e.)65
b(constants\))32 b Fl(Scheme.falseObject)f Fn(and)2070
1320 y Fl(Scheme.trueObject)p Fn(.)26 b(These)21 b(are)g(initialized)g
(to)h Fl(new)2070 1420 y(Boolean\(false\))15 b Fn(and)h
Fl(new)49 b(Boolean\(true\))p Fn(,)16 b(re-)2070 1519
y(specti)n(v)o(ely)-5 b(,)18 b(when)i(Ka)o(w)o(a)g(starts)h(up.)2170
1619 y(On)g(the)h(other)f(hand,)g(numbers)f(and)h(collections)g(are)h
(rea-)2070 1719 y(sonably)35 b(or)o(ganized)e(into)j(class)h
(hierarchies,)i(which)c(Ja)n(v)n(a)2070 1818 y(does)16
b(not)g(do)g(well.)24 b(So)16 b(Ka)o(w)o(a)h(has)f(its)h(o)n(wn)f
(classes)h(for)f(those,)2070 1918 y(discussed)k(in)g(the)h(follo)n
(wing)d(sections.)2070 2151 y Fp(4.)99 b(Symbols)2170
2350 y Fn(Symbols)34 b(represent)g(names,)k(and)c(do)h(not)f(need)h
(much)2070 2450 y(functionality)-5 b(.)26 b(Scheme)20
b(needs)h(to)h(be)f(able)g(to)h(con)m(v)o(ert)d(them)2070
2550 y(to)36 b(and)g(from)f(strings,)40 b(and)c(the)o(y)f(need)h(to)g
(be)g(\223interned\224)2070 2649 y(\(which)22 b(means)g(that)g(there)g
(is)h(a)g(global)f(table)g(to)h(ensure)e(that)2070 2749
y(there)26 b(is)h(a)g(unique)d(symbol)i(for)f(a)i(gi)n(v)o(en)e
(string\).)42 b(Symbols)2070 2848 y(are)16 b(immutable)e(and)i(ha)n(v)o
(e)f(no)h(accessible)g(internal)f(structure.)2070 2948
y(Currently)-5 b(,)34 b(Scheme)f(symbols)f(are)h(implemented)f(using)g
(a)2070 3048 y(Ka)o(w)o(a-speci\002c)20 b Fl(Symbol)f
Fn(class.)2170 3147 y(I)30 b(am)g(planning)e(to)j(re-implement)d
(symbols)h(to)h(use)h(the)2070 3247 y(the)36 b(standard)f(Ja)n(v)n(a)h
Fl(String)g Fn(class,)k(which)c(supports)f(an)2070 3347
y Fl(intern)30 b Fn(operator)-5 b(.)56 b(Note)31 b(that)g(the)g(Ja)n(v)
n(a)g Fl(String)g Fn(class)2070 3446 y(implements)36
b(immutable)f(strings,)41 b(and)36 b(is)h(therefore)e(can-)2070
3546 y(not)c(be)h(used)f(to)h(implement)e(Scheme)h(strings.)59
b(Ho)n(we)n(v)o(er)m(,)2070 3646 y(it)31 b(mak)o(es)g(sense)g(to)g(use)
g(it)g(to)g(implement)e(symbols,)j(since)2070 3745 y(the)h(w)o(ay)g
(Scheme)f(symbols)g(are)h(used)g(is)h(v)o(ery)d(similar)i(to)2070
3845 y(ho)n(w)d(Ja)n(v)n(a)h Fl(String)p Fn(s)g(are)g(used.)56
b(While)31 b(Ka)o(w)o(a)g(currently)2070 3944 y(assumes)f(a)g(Ja)n(v)n
(a)g(implementation)d(corresponding)f(to)k(v)o(er)n(-)2070
4044 y(sion)19 b(1.0)f(of)h(JDK)h(\(Sun')-5 b(s)19 b(Ja)n(v)n(a)g(De)n
(v)o(elopment)e(Kit\),)i(a)h(future)2070 4144 y(v)o(ersion)c(will)i
(depend)e(on)h(JDK)h(1.1)f(features.)23 b(One)18 b(such)f(ne)n(w)2070
4243 y(1.1)g(feature)f(is)j(that)f(literal)f(Ja)n(v)n(a)h
Fl(String)p Fn(s)g(will)g(be)f(required)2070 4343 y(to)32
b(be)g(automatically)e(interned.)58 b(This)32 b(will)h(mak)o(e)e(it)i
(e)n(v)o(en)2070 4443 y(more)24 b(appealing)g(to)h(use)g
Fl(String)g Fn(to)g(implement)f(Scheme)2070 4542 y(symbols.)2070
4775 y Fp(5.)99 b(Numbers)2170 4974 y Fn(Scheme)32 b(de\002nes)h(a)g
(\223numerical)f(to)n(wer\224)g(of)h(numerical)2070 5074
y(types:)60 b(number)m(,)40 b(comple)o(x,)g(real,)i(rational,)f(and)d
(inte)o(ger)-5 b(.)2070 5174 y(Ka)o(w)o(a)26 b(implements)g(the)g(full)
g(\223to)n(wer\224)g(of)g(Scheme)f(number)2070 5273 y(types,)37
b(which)d(are)h(all)g(sub-classes)f(of)g(the)g(abstract)h(class)2070
5373 y Fl(Quantity)19 b Fn(discussed)h(in)h(section)f(7.)2070
5539 y Fl(class)49 b Fm(Complex)g Fl(extends)f(Quantity)h({)2141
5639 y(public)f(abstract)h(RealNum)f(re\(\);)2141 5739
y(public)g(abstract)h(RealNum)f(im\(\);)2141 5840 y(...)p
eop
%%Page: 3 3
3 2 bop 0 523 a Fl(})100 666 y(Complex)19 b Fn(is)i(the)f(class)h(of)f
(abstract)g(comple)o(x)e(numbers.)0 766 y(It)23 b(has)g(three)g
(subclasses:)31 b(the)22 b(abstract)h(class)h Fl(RealNum)e
Fn(of)0 865 y(real)k(numbers;)h(the)e(general)g(class)i
Fl(CComplex)d Fn(where)i(the)0 965 y(components)20 b(are)h(arbitrary)g
Fl(RealNum)g Fn(\002elds;)i(and)e(the)h(op-)0 1065 y(timized)29
b Fl(DComplex)f Fn(where)g(the)h(components)e(are)i(repre-)0
1164 y(sented)20 b(by)g Fl(double)f Fn(\002elds.)0 1307
y Fl(class)49 b Fm(RealNum)g Fl(extends)g(Complex)f({)71
1407 y(public)g(final)h(RealNum)g(re\(\))71 1507 y({)g(return)g(this;)g
(})71 1607 y(public)f(final)h(RealNum)g(im\(\))71 1707
y({)g(return)g(IntNum.zero\(\);)e(})71 1807 y(public)h(abstract)h
(boolean)f(isNegative)177 1907 y(\(\);)71 2006 y(...)0
2106 y(})0 2249 y(class)h Fm(DFloNum)g Fl(extends)g(RealNum)f({)71
2348 y(double)g(value;)71 2448 y(...)0 2548 y(})100 2691
y Fn(Concrete)14 b(class)j(for)d(double-precision)e(\(64-bit\))i
(\003oating-)0 2790 y(point)19 b(real)i(numbers.)0 2933
y Fl(class)49 b Fm(RatNum)g Fl(extends)g(RealNum)f({)71
3033 y(public)g(abstract)h(IntNum)f(numerator\(\);)71
3133 y(public)g(abstract)h(IntNum)f(denominator\(\);)71
3232 y(...)0 3332 y(})100 3475 y(RatNum)p Fn(,)67 b(the)59
b(abstract)f(class)i(for)e(e)o(xact)g(rational)0 3574
y(numbers,)42 b(has)d(tw)o(o)g(sub-classes:)62 b Fl(IntFraction)37
b Fn(and)0 3674 y Fl(IntNum)p Fn(.)0 3817 y Fl(class)49
b Fm(IntFraction)f Fl(extends)h(RatNum)f({)71 3917 y(IntNum)g(num;)71
4016 y(IntNum)g(den;)71 4116 y(...)0 4216 y(})100 4359
y Fn(The)29 b Fl(IntFraction)e Fn(class)k(implements)d(fractions)g(in)0
4458 y(the)17 b(ob)o(vious)e(w)o(ay)-5 b(.)24 b(Exact)16
b(real)h(in\002nities)g(are)g(identi\002ed)f(with)0 4558
y(the)k(fractions)f Fl(1/0)i Fn(and)e Fl(-1/0)p Fn(.)0
4701 y Fl(class)49 b Fm(IntNum)h Fl(extends)f(RatNum)f({)71
4800 y(int)h(ival;)71 4900 y(int[])g(words;)71 5000 y(...)0
5099 y(})100 5242 y Fn(The)41 b Fl(IntNum)f Fn(concrete)g(class)j
(implements)d(in\002nite-)0 5342 y(precision)18 b(inte)o(gers.)24
b(The)19 b(v)n(alue)f(is)i(stored)f(in)h(the)f(\002rst)h
Fl(ival)0 5442 y Fn(elements)i(of)h Fl(words)p Fn(,)f(in)h(2')-5
b(s)23 b(complement)e(form)g(\(with)i(the)0 5541 y(lo)n(w-order)18
b(bits)j(in)f Fl(word[0])p Fn(\).)100 5641 y(There)d(are)i(already)e
(man)o(y)h(bignum)f(packages,)g(including)0 5740 y(a)29
b(couple)f(written)h(in)g(Ja)n(v)n(a.)52 b(What)29 b(are)g(the)g(adv)n
(antages)f(of)0 5840 y(this)21 b(one?)2153 523 y Fk(\017)41
b Fn(A)31 b(complete)e(set)i(of)f(operations,)h(including)d(gcd)i(and)
2236 623 y(lcm;)36 b(logical,)d(bit,)h(and)c(shift)h(operations;)k(po)n
(wer)30 b(by)2236 722 y(repeated)23 b(squaring;)i(all)g(of)f(the)h(di)n
(vision)e(modes)h(from)2236 822 y(Common)15 b(Lisp)i(\(\003oor)m(,)f
(ceiling,)h(truncate,)f(and)h(round\);)2236 922 y(and)j(e)o(xact)f(con)
m(v)o(ersion)f(to)i Fl(double)p Fn(.)2153 1094 y Fk(\017)41
b Fn(Consistenc)o(y)23 b(and)g(inte)o(gration)e(with)j(a)g(complete)e
(\223nu-)2236 1194 y(merical)f(to)n(wer)-5 b(.)f(\224)27
b(Speci\002cally)-5 b(,)21 b(consistenc)o(y)e(and)i(inte-)2236
1293 y(gration)e(with)h(\223\002xnum\224)f(\(see)i(belo)n(w\).)2153
1466 y Fk(\017)41 b Fn(Most)d(bignum)f(packages)f(use)j(a)f
(signed-magnitude)2236 1565 y(representation,)23 b(while)i(Ka)o(w)o(a)f
(uses)h(2')-5 b(s)25 b(complement.)2236 1665 y(This)36
b(mak)o(es)g(for)g(easier)g(inte)o(gration)e(with)j(\002xnums,)2236
1765 y(and)23 b(also)h(mak)o(es)g(it)g(cheap)f(to)h(implement)e
(logical)h(and)2236 1864 y(bit-\002ddling)18 b(operations.)2153
2037 y Fk(\017)41 b Fn(Use)51 b(of)f(all)h(32)f(bits)h(of)g(each)f
(\223big-digit\224)e(w)o(ord,)2236 2136 y(which)28 b(is)i(the)e(\223e)o
(xpected\224)f(space-ef)n(\002cient)g(represen-)2236
2236 y(tation.)70 b(More)34 b(importantly)-5 b(,)37 b(it)f(is)g
(compatible)d(with)2236 2336 y(the)20 b Fl(mpn)g Fn(routines)f(from)h
(the)g(Gnu)f(Multi-Precision)g(li-)2236 2435 y(brary)26
b(\()p Fl(gmp)p Fn(\))g([6)o(].)45 b(The)27 b Fl(mpn)g
Fn(routines)f(are)h(lo)n(w-le)n(v)o(el)2236 2535 y(algorithms)38
b(that)h(w)o(ork)f(on)h(unsigned)f(pre-allocated)2236
2634 y(bignums;)29 b(the)o(y)d(ha)n(v)o(e)h(been)f(transcribed)f(into)i
(Ja)n(v)n(a)g(in)2236 2734 y(the)e Fl(MPN)g Fn(class.)40
b(If)25 b(better)f(ef)n(\002cienc)o(y)g(is)i(desired,)f(it)h(is)2236
2834 y(straight-forw)o(ard)20 b(to)j(replace)g(the)g
Fl(MPN)f Fn(methods)g(with)2236 2933 y(nati)n(v)o(e)39
b(ones)h(that)h(call)g(the)f(highly-optimized)d Fl(mpn)2236
3033 y Fn(functions.)2170 3204 y(If)25 b(the)g(inte)o(ger)f(v)n(alue)g
(\002ts)i(within)f(a)g(signed)g(32-bit)f Fl(int)p Fn(,)2070
3303 y(then)15 b(it)h(is)g(stored)f(in)h Fl(ival)f Fn(and)g
Fl(words)g Fn(is)h(null.)23 b(This)16 b(a)n(v)n(oids)2070
3403 y(the)32 b(need)f(for)g(e)o(xtra)g(memory)f(allocation)h(for)g
(the)h Fl(words)2070 3503 y Fn(array)-5 b(,)30 b(and)g(also)g(allo)n
(ws)g(us)g(to)f(special-case)h(the)f(common)2070 3602
y(case.)2170 3703 y(As)e(a)h(further)d(optimization,)i(the)g(inte)o
(gers)f(in)h(the)g(range)2070 3803 y Fk(\000)p Fj(100)19
b Fn(to)h Fj(1024)f Fn(are)h(pre-allocated.)2070 4040
y Fp(6.)99 b(Mixed-type)26 b(arithmetic)2170 4244 y Fn(Man)o(y)35
b(operations)g(are)h(o)o(v)o(erloaded)e(to)i(ha)n(v)o(e)g(dif)n(ferent)
2070 4344 y(de\002nitions)20 b(depending)e(on)i(the)h(ar)o(gument)d
(types.)27 b(The)20 b(clas-)2070 4444 y(sic)c(e)o(xamples)e(are)h(the)h
(functions)d(of)i(arithmetic)g(such)g(as)h(\223)p Fl(+)p
Fn(\224,)2070 4543 y(which)27 b(needs)g(to)g(use)h(dif)n(ferent)d
(algorithms)h(depending)f(on)2070 4643 y(the)i(ar)o(gument)d(types.)44
b(If)26 b(there)h(is)g(a)g(\002x)o(ed)f(and)g(reasonably)2070
4743 y(small)d(set)h(of)f(number)e(types)h(\(as)i(is)f(the)g(case)h
(with)f(standard)2070 4842 y(Scheme\),)j(then)f(we)h(can)f(just)h
(enumerate)e(each)i(possibility)-5 b(.)2070 4942 y(Ho)n(we)n(v)o(er)m
(,)21 b(the)i(Ka)o(w)o(a)g(system)h(is)f(meant)g(to)g(be)g(more)f(e)o
(xten-)2070 5041 y(sible)f(and)e(support)g(adding)g(ne)n(w)h(number)e
(types.)2170 5143 y(The)g(solution)h(is)h(straight-forw)o(ard)c(in)j
(the)h(case)f(of)g(a)g(one-)2070 5242 y(operand)30 b(function)g(such)h
(as)i(\223ne)o(gate\224,)g(since)f(we)g(can)f(use)2070
5342 y(method)21 b(o)o(v)o(erriding)e(and)i(virtual)h(method)e(calls)j
(to)f(dynami-)2070 5442 y(cally)17 b(select)h(the)g(correct)e(method.)
23 b(Ho)n(we)n(v)o(er)m(,)16 b(it)i(is)g(more)f(dif-)2070
5541 y(\002cult)g(in)g(the)g(case)h(of)f(a)g(binary)f(method)f(lik)o(e)
i(\223)p Fl(+)p Fn(,)-6 b(\224)18 b(since)f(clas-)2070
5641 y(sic)g(object-oriented)c(languages)i(\(including)f(Ja)n(v)n(a\))i
(only)f(sup-)2070 5740 y(port)g(dynamic)e(method)h(selection)h(using)g
(the)g(type)g(of)g(the)g(\002rst)2070 5840 y(ar)o(gument)21
b(\(\223)p Fl(this)p Fn(\224\).)33 b(Common)22 b(Lisp)h(and)g(some)g
(Scheme)p eop
%%Page: 4 4
4 3 bop 0 523 a Fn(dialects)19 b(support)e(dynamic)g(method)g
(selection)h(using)g(all)h(the)0 623 y(ar)o(guments,)e(and)i(in)h(f)o
(act)g(the)f(problem)f(of)h(binary)f(arithmetic)0 722
y(operations)e(is)i(probably)d(the)j(most)f(ob)o(vious)f(e)o(xample)g
(where)0 822 y(\223multi-dispatch\224)i(is)j(useful.)100
922 y(Since)33 b(Ja)n(v)n(a)g(does)g(not)g(ha)n(v)o(e)f
(multi-dispatch,)j(we)e(ha)n(v)o(e)0 1021 y(to)26 b(solv)o(e)g(the)g
(problem)f(in)h(other)f(w)o(ays.)43 b(Smalltalk)26 b(has)h(the)0
1121 y(same)e(problems,)g(and)g(solv)o(ed)f(it)i(using)f(\223coerci)n
(v)o(e)e(general-)0 1221 y(ity\224:)38 b(Each)26 b(number)f(class)j
(has)f(a)g(generality)e(number)m(,)h(and)0 1320 y(operands)c(of)h(lo)n
(wer)f(generality)g(are)h(con)m(v)o(erted)e(to)i(the)h(class)0
1420 y(with)k(the)g(higher)f(generality)-5 b(.)47 b(This)28
b(is)h(inef)n(\002cient)e(because)0 1520 y(of)e(all)h(the)g(con)m(v)o
(ersions)d(and)i(temporary)f(objects)h(\(see)h([3)o(]\),)0
1619 y(and)d(it)i(is)g(limited)f(to)g(what)g(e)o(xtent)f(you)g(can)h
(add)f(ne)n(w)h(kinds)0 1719 y(of)c(number)e(types.)100
1819 y(In)25 b(\223double)g(dispatch\224)g([7)o(])h(the)g(e)o
(xpression)f Fl(x-y)h Fn(is)h(im-)0 1918 y(plemented)34
b(as)i Fl(x.sub\(y\))p Fn(.)70 b(Assuming)35 b(the)h(\(run-time\))0
2018 y(class)c(of)f Fl(x)h Fn(is)g Fl(Tx)g Fn(and)f(that)g(of)g
Fl(y)h Fn(is)g Fl(Ty)p Fn(,)i(this)e(causes)g(the)0 2118
y Fl(sub)e Fn(method)e(de\002ned)h(in)g Fl(Tx)h Fn(to)g(be)g(in)m(v)n
(ok)o(ed,)g(which)f(just)0 2217 y(does)23 b Fl(y.subTx\(x\))p
Fn(.)33 b(That)23 b(in)m(v)n(ok)o(es)g(the)g Fl(subTx)g
Fn(method)0 2317 y(de\002ned)g(in)g Fl(Ty)h Fn(which)f(can)h(without)f
(further)f(testing)h(do)h(the)0 2417 y(subtraction)19
b(for)g(types)h Fl(Tx)h Fn(and)e Fl(Ty)p Fn(.)100 2516
y(The)33 b(problem)f(with)h(this)i(approach)c(is)k(that)e(it)i(is)f
(dif)n(\002-)0 2616 y(cult)24 b(to)h(add)e(a)i(ne)n(w)f
Fl(Tz)h Fn(class,)h(since)e(you)f(ha)n(v)o(e)h(to)h(also)f(add)0
2716 y Fl(subTz)d Fn(methods)g(in)h(all)g(the)f(e)o(xisting)g(number)f
(classes,)j(not)0 2815 y(to)d(mention)f Fl(addTz)h Fn(and)g(all)g(the)h
(other)e(operations.)100 2915 y(In)24 b(Ka)o(w)o(a,)h
Fl(x-y)f Fn(is)h(also)g(implemented)d(by)i Fl(x.sub\(y\))p
Fn(.)0 3015 y(The)37 b Fl(sub)f Fn(method)g(of)g Fl(Tx)h
Fn(checks)g(if)g Fl(Ty)g Fn(is)h(one)e(of)h(the)0 3115
y(types)43 b(it)h(kno)n(ws)f(ho)n(w)g(to)g(handle.)94
b(If)43 b(so,)49 b(it)44 b(does)g(the)0 3214 y(subtraction)37
b(and)h(returns)g(the)g(result)h(itself.)80 b(Otherwise,)0
3314 y Fl(Tx.sub)24 b Fn(does)f Fl(y.sub_reversed\(x\))p
Fn(.)34 b(This)25 b(in)m(v)n(ok)o(es)0 3413 y Fl(Ty.sub_reversed)16
b Fn(\(or)h Fl(sub_reversed)g Fn(as)i(de\002ned)0 3513
y(in)27 b(a)g(super)n(-class)f(of)g Fl(Ty)p Fn(\).)44
b(No)n(w)26 b Fl(Ty)h Fn(\(or)f(one)f(of)i(its)g(super)n(-)0
3613 y(classes\))20 b(gets)g(a)g(chance)e(to)i(see)g(if)g(it)g(kno)n
(ws)f(ho)n(w)g(to)g(subtract)0 3712 y(itself)i(from)e(a)i
Fl(Tx)f Fn(object.)100 3812 y(The)37 b(adv)n(antage)f(of)h(this)h
(scheme)f(is)i(\003e)o(xibility)-5 b(.)76 b(The)0 3912
y(kno)n(wledge)36 b(of)i(ho)n(w)g(to)h(handle)e(a)i(binary)f(operation)
e(for)0 4011 y(types)30 b Fl(Tx)g Fn(and)f Fl(Ty)h Fn(can)f(be)h(in)g
(either)f(of)h Fl(Tx)g Fn(or)f Fl(Ty)h Fn(or)f(ei-)0
4111 y(ther)23 b(of)h(their)f(super)n(-classes.)35 b(This)24
b(mak)o(es)g(is)g(easier)g(to)g(add)0 4211 y(ne)n(w)c(classes)h
(without)f(ha)n(ving)f(to)h(modify)f(e)o(xisting)g(ones.)0
4444 y Fp(7.)99 b(Quantities)100 4644 y Fn(The)16 b(DSSSL)i(language)d
([9)o(])j(is)f(a)h(dialect)f(of)f(Scheme)h(used)0 4744
y(to)23 b(process)f(SGML)h(documents.)30 b(DSSSL)24 b(has)e
(\223quantities\224)0 4843 y(in)j(addition)e(to)i(real)f(and)g(inte)o
(ger)g(numbers.)36 b(Since)25 b(DSSSL)0 4943 y(is)h(used)f(to)h(format)
e(documents,)g(it)i(pro)o(vides)e(length)g(v)n(alues)0
5043 y(that)j(are)g(a)g(multiple)f(of)h(a)g(meter)f(\()p
Fo(e)o(.g)o(.)44 b Fl(0.2m)p Fn(\),)28 b(as)f(well)h(as)0
5142 y(deri)n(v)o(ed)14 b(units)h(lik)o(e)h Fl(cm)f Fn(and)g
Fl(pt)h Fn(\(point\).)22 b(A)16 b(DSSSL)g(quantity)0
5242 y(is)h(a)f(product)e(of)i(a)g(dimension-less)f(number)f(with)i(an)
g(inte)o(gral)0 5342 y(po)n(wer)22 b(of)g(a)h(length)f(unit)h(\(the)f
(meter\).)32 b(A)23 b(\(pure\))f(number)f(is)0 5441 y(a)g(quantity)e
(where)g(the)h(length)g(po)n(wer)f(is)i(zero.)100 5541
y(F)o(or)30 b(Ka)o(w)o(a,)i(I)f(w)o(anted)e(to)i(mer)o(ge)d(the)j
(Scheme)e(number)0 5641 y(types)22 b(with)g(the)g(DSSSL)h(number)d
(types,)i(and)g(also)g(general-)0 5740 y(ize)28 b(the)g(DSSSL)g
(quantities)f(to)h(support)e(other)h(dimensions)0 5840
y(\(such)20 b(as)i(mass)f(and)g(time\))g(and)f(units)h(\(such)f(as)i
Fl(kg)f Fn(and)f(sec-)2070 523 y(onds\).)k(Quantities)19
b(are)g(implemented)e(by)i(the)h(abstract)f(class)2070
623 y Fl(Quantity)p Fn(.)39 b(A)25 b Fo(quantity)f Fn(is)i(a)f(product)
f(of)g(a)i Fl(Unit)f Fn(and)f(a)2070 722 y(pure)d(number)-5
b(.)28 b(The)22 b(number)e(can)i(be)f(an)h(arbitrary)e(comple)o(x)2070
822 y(number)-5 b(.)2070 988 y Fl(class)49 b Fm(Quantity)f
Fl(extends)g(Number)h({)2141 1087 y(public)f(Unit)h(unit\(\))2141
1188 y({)g(return)g(Unit.Empty;)f(})2141 1287 y(public)g(abstract)h
(Complex)f(number\(\);)2141 1388 y(...)2070 1488 y(})2070
1653 y(class)h Fm(CQuantity)f Fl(extends)g(Quantity)h({)2141
1753 y(Complex)f(num;)2141 1853 y(Unit)h(unt;)2141 1952
y(public)f(Complex)h(number\(\))2141 2053 y({)g(return)g(num;)g(})2141
2152 y(public)f(Unit)h(unit\(\))2141 2253 y({)g(return)g(unt;)g(})2141
2352 y(...)2070 2452 y(})2170 2618 y Fn(A)25 b Fl(CQuantity)e
Fn(is)i(a)g(concrete)f(class)h(that)g(implements)2070
2718 y(general)20 b Fl(Quantities)p Fn(.)25 b(But)c(usually)f(we)h
(don')o(t)e(need)h(that)2070 2817 y(much)f(generality)-5
b(,)18 b(and)i(instead)g(use)g Fl(DQuanity)p Fn(.)2070
2983 y Fl(class)49 b Fm(DQuantity)f Fl(extends)g(Quantity)h({)2141
3083 y(double)f(factor;)2141 3182 y(Unit)h(unt;)2141
3282 y(public)f(final)h(Unit)g(unit\(\))2141 3382 y({)g(return)g(unt;)g
(})2141 3482 y(public)f(final)h(Complex)g(number\(\))2141
3583 y({)g(return)g(new)g(DFloNum\(factor\);)e(})2141
3682 y(...)2070 3782 y(})2070 3948 y(class)i Fm(Unit)h
Fl(extends)e(Quantity)g({)2141 4047 y(String)g(name;)h(//)h
Fo(Optional.)2141 4147 y Fl(Dimensions)e(dims;)2141 4247
y(double)g(factor;)2141 4346 y(...)2070 4446 y(})2170
4612 y Fn(A)33 b Fl(Unit)g Fn(is)h(a)f(product)e(of)i(a)h
(\003oating-point)c Fl(factor)2070 4711 y Fn(and)45 b(one)g(or)g(more)f
(primiti)n(v)o(e)g(units,)52 b(combined)43 b(into)i(a)2070
4811 y Fl(Dimensions)28 b Fn(object.)50 b(The)29 b Fl(Unit)g
Fn(name)f(ha)n(v)o(e)h(a)g(name)2070 4911 y(\(such)f(as)i(\223)p
Fl(kg)p Fn(\224\),)g(which)e(is)i(used)f(for)f(printing,)h(and)f(when)
2070 5010 y(parsing)19 b(literals.)2070 5176 y Fl(class)49
b Fm(BaseUnit)h Fl(extends)e(Unit)h({)2141 5276 y(int)g(index;)2141
5375 y(...)2070 5475 y(})2170 5641 y Fn(A)39 b Fl(BaseUnit)f
Fn(is)j(a)e(primiti)n(v)o(e)f(unit)h(that)g(is)h(not)f(de-)2070
5740 y(\002ned)22 b(in)g(terms)h(of)f(an)o(y)f(other)h
Fl(Unit)p Fn(,)g(for)g(e)o(xample)f(the)h(me-)2070 5840
y(ter)-5 b(.)35 b(Each)22 b Fl(BaseUnit)h Fn(has)g(a)h(dif)n(ferent)e
Fl(index)p Fn(,)h(which)g(is)p eop
%%Page: 5 5
5 4 bop 0 523 a Fn(used)26 b(for)f(identi\002cation)f(and)i(comparison)
e(purposes.)40 b(T)-7 b(w)o(o)0 623 y Fl(BaseUnit)p Fn(s)23
b(ha)n(v)o(e)f(the)h(same)h Fl(index)e Fn(if)i(and)e(only)h(if)g(the)o
(y)0 722 y(are)d(the)g(same)h Fl(BaseUnit)p Fn(.)0 867
y Fl(class)49 b Fm(Dimensions)h Fl({)71 967 y(BaseUnit[])e(bases;)71
1066 y(short[])g(powers;)71 1166 y(...)0 1266 y(})100
1410 y Fn(A)37 b Fl(Dimensions)e Fn(object)h(is)h(a)g(product)e(and/or)
g(ratio)0 1510 y(of)c Fl(BaseUnit)p Fn(s.)56 b(Y)-9 b(ou)30
b(can)h(think)f(of)h(it)g(as)h(a)f(data)g(struc-)0 1609
y(ture)d(that)g(maps)f(e)n(v)o(ery)g Fl(BaseUnit)g Fn(to)h(an)g(inte)o
(ger)e(po)n(wer)-5 b(.)0 1709 y(The)39 b Fl(bases)h Fn(array)e(is)j(a)f
(list)h(of)e(the)g Fl(BaseUnit)p Fn(s)g(that)0 1809 y(ha)n(v)o(e)28
b(a)h(non-zero)d(po)n(wer)m(,)i(in)h(order)e(of)h(the)g
Fl(index)g Fn(of)h(the)0 1908 y Fl(BaseUnit)p Fn(.)41
b(The)25 b Fl(powers)h Fn(array)f(gi)n(v)o(es)g(the)h(po)n(wer)f(\(e)o
(x-)0 2008 y(ponent\))h(of)h(the)g Fl(BaseUnit)g Fn(that)g(has)h(the)g
(same)f(inde)o(x)f(in)0 2108 y(the)20 b Fl(bases)g Fn(array)-5
b(.)100 2207 y(T)e(w)o(o)31 b Fl(Dimensions)g Fn(objects)g(are)h(equal)
e(if)i(the)o(y)f(ha)n(v)o(e)0 2307 y(the)26 b(same)g(list)h(of)e
Fl(bases)h Fn(and)f Fl(powers)p Fn(.)41 b Fl(Dimensions)0
2406 y Fn(objects)17 b(are)f(\223interned\224)f(\(using)h(a)i(global)d
(hash)i(table\))f(so)h(that)0 2506 y(the)o(y)29 b(are)g(equal)g(only)f
(if)i(the)o(y)e(are)i(the)f(same)h(object.)51 b(This)0
2606 y(mak)o(es)20 b(it)h(easy)f(to)h(implement)e(addition)f(and)i
(subtraction:)0 2739 y Fl(public)49 b(static)f(DQuantity)h(add)106
2838 y(\(DQuantity)f(x,)h(DQuantity)g(y\))0 2938 y({)71
3037 y(if)g(\(x.unit\(\).dims)e(!=)j(y.unit\(\).dims\))141
3137 y(throw)f(new)h(ArithmeticException)212 3237 y(\("units)f
(mis-match"\);)71 3336 y(double)f(r)i(=)g(y.unit\(\).factor)141
3436 y(/)g(x.unit\(\).factor;)71 3536 y(double)e(s)i(=)g(x.factor)e(+)i
(r)f(*)h(y.factor;)71 3635 y(return)e(new)i(DQuantity)e(\(s,)h
(x.unit\(\)\);)0 3735 y(})100 3979 y Fn(The)20 b Fl(Unit)g
Fn(of)g(the)h(result)f(of)g(an)h(addition)e(or)h(subtraction)0
4079 y(is)k(the)f Fl(Unit)g Fn(of)f(the)h(\002rst)h(operand.)31
b(This)23 b(mak)o(es)g(it)g(easy)g(to)0 4178 y(con)m(v)o(ert)18
b(units:)0 4312 y Fl(kawa>)49 b(\(+)g(0cm)h(2.5m\))0
4411 y(250cm)100 4545 y Fn(Because)21 b(Ka)o(w)o(a)g(represents)e
(quantities)i(relati)n(v)o(e)f(to)h(user)n(-)0 4644 y(speci\002ed)h
(units,)h(instead)f(of)g(representing)f(them)h(relati)n(v)o(e)f(to)0
4744 y(primiti)n(v)o(e)26 b(base)h(units,)h(it)f(can)g(automatically)f
(print)g(quanti-)0 4844 y(ties)20 b(using)f(the)g(user')-5
b(s)20 b(preferred)d(units.)25 b(Ho)n(we)n(v)o(er)m(,)17
b(this)j(does)0 4943 y(mak)o(e)31 b(multiplication)f(and)g(di)n(vision)
h(more)f(dif)n(\002cult.)58 b(The)0 5043 y(actual)21
b(calculation)e(\(\002nding)h(the)g(right)h Fl(Dimensions)e
Fn(and)0 5143 y(multiplying)37 b(the)i(constant)f(f)o(actors\))g(is)i
(straight-forw)o(ard.)0 5242 y(The)19 b(problem)f(is)i(generating)e
(the)h(ne)n(w)g(compound)e(unit,)i(and)0 5342 y(later)h(printing)f(out)
h(the)h(result)f(in)h(a)f(human-friendly)d(format.)0
5442 y(There)k(is)i(no)e(ob)o(vious)f(right)h(w)o(ay)h(to)g(do)f(this.)
31 b(Ka)o(w)o(a)22 b(creates)0 5541 y(a)g Fl(MulUnit)g
Fn(to)g(represent)f(a)h(compound)d(unit,)j(b)n(ut)g(it)h(is)g(not)0
5641 y(ob)o(vious)33 b(which)i(simpli\002cations)g(should)f(be)h(done)f
(when.)0 5740 y(Ka)o(w)o(a)18 b(uses)f(a)h(fe)n(w)g(heuristics)f(to)g
(simplify)g(compound)e(units,)0 5840 y(b)n(ut)20 b(this)h(is)g(an)f
(area)g(that)g(could)g(be)g(impro)o(v)o(ed.)2070 523
y Fp(8.)99 b(Collections)2170 739 y Fn(Ka)o(w)o(a)45
b(has)h(a)g(rudimentary)c(hierarchy)h(of)j(collection)2070
839 y(classes.)2070 1034 y Fl(class)j Fm(Sequence)h Fl({)2141
1133 y(abstract)e(public)h(int)g(length\(\);)2141 1233
y(abstract)f(public)h(Object)f(elementAt)2247 1332 y(\(int)h(index\);)
2141 1432 y(...)2070 1532 y(})2170 1721 y Fn(A)17 b Fl(Sequence)f
Fn(is)i(the)f(abstract)f(class)i(that)f(includes)f(lists,)2070
1820 y(v)o(ectors,)j(and)h(strings.)2070 2015 y Fl(class)49
b Fm(FString)g Fl(extends)f(Sequence)h({)2141 2114 y(char[])f(value;)
2141 2214 y(...)2070 2314 y(})2170 2503 y Fn(Used)21
b(to)h(implement)e(\002x)o(ed-length)g(mutable)g(strings)i(\(ar)n(-)
2070 2602 y(ray)32 b(of)h(Unicode)e(character\).)62 b(This)33
b(is)g(used)g(to)g(represent)2070 2702 y(Scheme)20 b(strings.)2070
2896 y Fl(class)49 b Fm(FV)-8 b(ector)48 b Fl(extends)g(Sequence)h({)
2141 2996 y(Object[])f(value;)2141 3096 y(...)2070 3195
y(})2170 3384 y Fn(Used)d(to)g(implement)f(\002x)o(ed-length)f(mutable)
h(general)2070 3484 y(one-dimensional)16 b(array)i(of)h
Fl(Object)p Fn(.)24 b(This)c(is)g(used)f(to)g(rep-)2070
3583 y(resent)h(Scheme)g(v)o(ectors.)2070 3778 y Fl(class)49
b Fm(List)h Fl(extends)f(Sequence)f({)2141 3878 y(protected)g(List)h
(\(\))g({)h(})2141 3977 y(static)e(public)h(List)g(Empty)2211
4077 y(=)h(new)f(List)g(\(\);)2141 4176 y(...)2070 4276
y(})2170 4465 y Fn(Used)23 b(to)g(represent)f(Scheme)g(\(link)o(ed\))f
(lists.)35 b(The)22 b(empty)2070 4565 y(list)42 b Fl('\(\))e
Fn(is)i(the)e(static)h(\(global\))e(v)n(alue)h Fl(List.Empty)p
Fn(.)2070 4664 y(Non-empty-lists)18 b(are)j(implemented)d(using)h
Fl(Pair)h Fn(objects.)2070 4859 y Fl(class)49 b Fm(P)o(air)g
Fl(extends)g(Sequence)f({)2141 4958 y(public)g(Object)h(car;)2141
5058 y(public)f(Object)h(cdr;)2141 5158 y(...)2070 5257
y(})2170 5446 y Fn(Used)20 b(for)g(Scheme)f(pairs.)2070
5641 y Fl(class)49 b Fm(P)o(airW)o(ithP)n(osition)f Fl(extends)g(Pair)h
({)2141 5740 y(...)2070 5840 y(})p eop
%%Page: 6 6
6 5 bop 100 523 a Fn(Lik)o(e)23 b Fl(Pair)p Fn(,)h(b)n(ut)g(includes)f
(the)h(\002lename)f(and)g(linenum-)0 623 y(ber)d(in)g(the)g(\002le)h
(from)e(which)h(the)g(pair)g(w)o(as)h(read.)100 722 y(Future)47
b(plans)i(include)e(more)h(interesting)g(collection)0
822 y(classes,)35 b(such)d(a)g(sequences)e(implemented)g(as)i(a)g
(seekable)0 922 y(disk)21 b(\002le;)h(lazily)f(e)n(v)n(aluated)e
(sequences;)h(hash)h(tables;)h(APL-)0 1021 y(style)f(multi-dimensional)
c(arrays;)j(stretchy)f(b)n(uf)n(fers.)1591 991 y Fi(1)0
1252 y Fp(9.)99 b(Pr)n(ocedur)n(es)100 1449 y Fn(Scheme)32
b(has)h(procedures)e(as)i(\002rst-class)h(v)n(alues.)62
b(Ja)n(v)n(a)0 1548 y(does)23 b(not.)34 b(Ho)n(we)n(v)o(er)m(,)22
b(we)h(can)g(simulate)g(procedure)e(v)n(alues,)0 1648
y(by)f(o)o(v)o(erriding)d(of)j(virtual)f(methods.)0 1810
y Fl(class)49 b Fm(Pr)o(ocedur)o(e)f Fl({)71 1910 y(public)g(abstract)h
(Object)f(applyN)177 2009 y(\(Object[])g(args\);)71 2109
y(public)g(abstract)h(Object)f(apply0)h(\(\);)71 2209
y(public)f(abstract)h(Object)f(apply1)177 2308 y(\(Object)g(arg1\);)71
2408 y(...;)71 2508 y(public)g(abstract)h(Object)f(apply4)177
2607 y(\(Object)g(arg1,)h(...,)g(Object)g(arg4\);)71
2707 y(...)0 2806 y(})100 2968 y Fn(W)-7 b(e)28 b(represent)d(Scheme)i
(procedures)d(using)i(sub-classes)0 3068 y(of)32 b(the)g(abstract)f
(class)i Fl(Procedure)p Fn(.)59 b(T)-7 b(o)32 b(call)h(\(apply\))d(a)0
3168 y(procedure)23 b(with)i(no)f(ar)o(guments,)g(you)g(in)m(v)n(ok)o
(e)g(its)i Fl(apply0)0 3267 y Fn(method;)31 b(to)d(in)m(v)n(ok)o(e)e(a)
j(procedure,)e(passing)h(it)g(a)h(single)f(ar)n(-)0 3367
y(gument,)23 b(you)f(use)i(its)g Fl(apply1)f Fn(method;)h(and)f(so)h
(on)f(using)0 3467 y Fl(apply4)k Fn(if)h(you)f(ha)n(v)o(e)g(4)h(ar)o
(guments.)46 b(Alternati)n(v)o(ely)-5 b(,)27 b(you)0
3566 y(can)e(b)n(undle)e(up)i(all)g(the)g(ar)o(guments)d(into)j(an)g
(array)-5 b(,)24 b(and)g(use)0 3666 y(the)30 b Fl(applyN)f
Fn(method.)52 b(If)30 b(you)f(ha)n(v)o(e)g(more)g(than)g(4)h(ar)o(gu-)0
3765 y(ments,)20 b(you)f(ha)n(v)o(e)h(to)g(use)g Fl(applyN)p
Fn(.)100 3865 y(Notice)42 b(that)i(all)f Fl(Procedure)f
Fn(sub-classes)h(ha)n(v)o(e)f(to)0 3965 y(implement)g(all)i(6)f
(methods,)k(at)d(least)g(to)f(the)g(e)o(xtent)g(of)0
4064 y(thro)n(wing)28 b(an)h(e)o(xception)f(if)h(it)h(is)h(passed)e
(the)h(wrong)e(num-)0 4164 y(ber)33 b(of)h(ar)o(guments.)64
b(Ho)n(we)n(v)o(er)m(,)35 b(there)f(are)g(utility)f(classes)0
4264 y Fl(Procedure0)19 b Fn(to)h Fl(Procedure4)f Fn(and)h
Fl(ProcedureN)p Fn(.)0 4426 y Fl(class)49 b Fm(Pr)o(ocedur)o(e1)e
Fl(extends)i(Procedure)f({)71 4525 y(public)g(abstract)h(Object)f
(applyN)177 4625 y(\(Object[])g(args\))71 4724 y({)141
4824 y(if)i(\(args.length)d(!=)j(1\))212 4924 y(throw)f(new)g
(WrongArguments\(\);)141 5023 y(return)g(apply1\(args[0]\);)71
5123 y(})71 5222 y(public)f(Object)h(apply0\(\))141 5323
y({)h(throw)f(new)g(WrongArguments\(\);})71 5423 y(public)f(abstract)h
(Object)f(apply1)177 5522 y(\(Object)g(arg1\);)p 0 5603
732 4 v 90 5659 a Fh(1)120 5682 y Fg(Man)o(y)65 b(of)f(these)i(ideas)g
(were)f(implemented)i(in)e(my)f(ear)o(-)0 5761 y(lier)85
b(e)o(xperimental)i(language)f Ff(Q)d Fg(\226)g(see)h([1])g(and)g
Ff(ftp:)0 5840 y(//ftp.cygnus.com/pub/bothner/Q/)p Fg(.)2141
510 y Fl(public)48 b(Object)h(apply2\(Object)f(arg1,)2247
609 y(Object)h(arg2\))2141 709 y({)g(throw)g(new)g
(WrongArguments\(\);})2141 809 y(...)2070 908 y(})2170
1076 y Fn(Primiti)n(v)o(e)18 b(procedures)f(are)i(generally)e(written)i
(in)g(Ja)n(v)n(a)h(as)2070 1176 y(sub-classes)g(of)g(these)h(helper)e
(classes.)26 b(F)o(or)20 b(e)o(xample:)2070 1344 y Fl(class)49
b Fm(cdr)h Fl(extends)e(Procedure1)g({)2141 1444 y(public)g(Object)h
(apply1\(Object)f(arg1\))2211 1544 y({)i(return)f(\(\(Pair\))f
(arg1\).cdr;)g(})2070 1644 y(})2170 1812 y Fn(A)28 b(user)n(-de\002ned)
f(Scheme)g(procedure)f(is)j(compiled)e(to)h(a)2070 1912
y(class)e(that)f(is)h(descended)d(from)h Fl(Procedure)p
Fn(.)37 b(F)o(or)25 b(e)o(xam-)2070 2011 y(ple,)19 b(a)h(v)n
(ariable-ar)o(gument)15 b(procedure)i(is)j(implemented)d(as)j(a)2070
2111 y(sub-class)27 b(of)f Fl(ProcedureN)p Fn(,)f(with)i(an)g
Fl(applyN)f Fn(method)2070 2210 y(comprising)34 b(the)j(bytecode)d
(compiled)h(from)g(the)h(Scheme)2070 2310 y(procedure)24
b(body)-5 b(.)43 b(Thus)27 b(primiti)n(v)o(e)e(and)i(user)n(-de\002ned)
e(pro-)2070 2410 y(cedure)19 b(ha)n(v)o(e)h(the)g(same)g(calling)g(con)
m(v)o(ention.)2170 2510 y(If)32 b(a)h(nested)f(procedure)e(references)h
(a)i(le)o(xical)f(v)n(ariable)2070 2609 y(in)j(an)g(outer)f(procedure,)
i(the)f(inner)f(procedure)e(is)k(imple-)2070 2709 y(mented)17
b(by)g(a)h(\223closure\224.)23 b(Ka)o(w)o(a)17 b(implements)g(a)h
(closure)f(as)h(a)2070 2809 y Fl(Procedure)e Fn(object)g(with)i(a)f
(\223static)h(link\224)f(\002eld)g(that)g(points)2070
2908 y(to)31 b(the)f(inherited)f(en)m(vironment.)53 b(In)30
b(that)h(case)f(the)h(le)o(xical)2070 3008 y(v)n(ariable)c(must)g(be)h
(heap)f(allocated,)i(b)n(ut)f(otherwise)f(le)o(xical)2070
3108 y(v)n(ariables)21 b(use)h(local)f(Ja)n(v)n(a)h(v)n(ariable)e
(slots.)30 b(\(This)22 b(is)g(concep-)2070 3207 y(tually)k(similar)g
(to)g(the)g(\223Inner)e(classes\224)j(proposed)d(for)h(JDK)2070
3307 y(1.1.\))2070 3475 y Fl(class)49 b Fm(ModuleBody)g
Fl(extends)g(Procedure0)f({)2141 3575 y(public)g(Object)h(apply0\(\))
2141 3675 y({return)f(run\()2353 3775 y(Environment.current\(\)\);})
2141 3875 y(public)g(abstract)h(Object)f(run)2247 3974
y(\(Environment)f(env\);)2141 4074 y(...)2070 4173 y(})2170
4341 y Fn(T)-7 b(op-le)n(v)o(el)20 b(forms)h(\(including)e(top-le)n(v)o
(el)h(de\002nitions\))h(are)2070 4441 y(treated)29 b(as)h(if)f(the)o(y)
g(were)g(nested)g(inside)g(a)g(dummy)f(proce-)2070 4541
y(dure.)58 b(A)32 b Fl(ModuleBody)f Fn(is)h(such)f(a)h(dummy)e
(procedure.)2070 4640 y(When)25 b(a)h(\002le)g(is)h Fl(load)p
Fn(ed,)e(the)h(result)f(is)i(a)f Fl(ModuleBody)p Fn(;)2070
4740 y(in)m(v)n(oking)k Fl(run)i Fn(causes)h(the)f(top-le)n(v)o(el)e
(actions)i(to)h(be)f(e)o(x)o(e-)2070 4839 y(cuted.)2070
5073 y Fp(10.)99 b(Ov)o(er)o(view)25 b(of)f(compilation)2170
5274 y Fn(These)c(are)g(the)g(stages)h(of)f(compilation:)2070
5442 y Fm(Reading)41 b Fn(The)36 b(\002rst)g(compilation)f(stage)h
(reads)g(the)g(input)2236 5541 y(from)g(a)h(\002le,)42
b(from)35 b(a)j(string,)i(or)d(from)f(the)g(interac-)2236
5641 y(ti)n(v)o(e)g(command)e(interpreter)-5 b(.)73 b(The)35
b(result)i(is)g(one)f(or)2236 5740 y(more)20 b(Scheme)g(forms)g(\(S-e)o
(xpressions\),)e(usually)i(lists.)2236 5840 y(If)31 b(reading)e
(commands)g(interacti)n(v)o(ely)-5 b(,)31 b(only)f(a)h(single)p
eop
%%Page: 7 7
7 6 bop 166 523 a Fn(form)18 b(is)i(read;)e(if)h(reading)f(from)f(a)j
(\002le)f(or)g(string,)f(all)i(the)166 623 y(forms)e(are)g(read)g
(until)g(end-of-\002le)e(or)i(end-of-string;)e(in)166
722 y(either)29 b(case,)j(the)d(result)h(is)g(treated)f(as)h(the)f
(body)f(of)h(a)166 822 y(dummy)19 b(function)f(\()p Fo(i.e)o(.)25
b Fn(a)20 b Fl(ModuleBody)p Fn(\).)0 990 y Fm(T)-6 b(ranslation)41
b Fn(The)69 b(source)h(form)f(body)f(is)j(re)n(written)166
1090 y(into)61 b(an)g Fl(Expression)f Fn(object,)71 b(speci\002cally)61
b(a)166 1189 y Fl(ModuleExp)p Fn(.)e(This)32 b(stage)g(handles)f(macro)
g(e)o(xpan-)166 1289 y(sion)23 b(and)f(le)o(xical)h(name)f(binding.)31
b(Man)o(y)22 b(\(future\))f(op-)166 1389 y(timizations)16
b(can)g(be)f(done)g(in)i(this)f(phase)g(by)f(annotating)166
1488 y(and)20 b(re-arranging)d Fl(Expression)i Fn(trees.)0
1656 y Fm(Code)h(generation)40 b Fn(The)27 b(resulting)f
Fl(ModuleExp)g Fn(is)i(com-)166 1756 y(piled)i(into)g(one)g(or)g(more)f
(byte-coded)f(classes.)56 b(This)166 1856 y(is)23 b(done)e(by)h(in)m(v)
n(oking)d(the)j(virtual)g Fl(compile)f Fn(method)166
1955 y(recursi)n(v)o(ely)27 b(on)i(the)f Fl(Expression)p
Fn(s,)i(which)f(gener)n(-)166 2055 y(ates)38 b(instructions)f(\(using)f
(the)i Fl(codegen)e Fn(package\))166 2155 y(to)42 b(e)n(v)n(aluate)e
(the)h(e)o(xpression)f(and)h(lea)n(v)o(e)g(the)h(result)166
2254 y(on)36 b(the)g(Ja)n(v)n(a)g(operand)e(stack.)72
b(At)37 b(the)f(end)f(we)h(ask)166 2354 y(the)29 b Fl(codegen)g
Fn(package)f(to)h(write)g(out)g(the)g(resulting)166 2453
y(classes)23 b(and)e(methods.)27 b(The)o(y)21 b(can)g(be)g(written)g
(to)h(a)g(\002le)166 2553 y(\(for)d(future)g(use\),)h(or)g(into)g(byte)
g(arrays)f(in)i(memory)-5 b(.)0 2721 y Fm(Loading)41
b Fn(The)27 b(compiled)g(bytecodes)f(are)h(loaded)g(into)h(the)166
2821 y(Ka)o(w)o(a)23 b(interpreter)-5 b(.)32 b(In)22
b(the)h(case)g(of)g(code)f(that)h(is)g(com-)166 2921
y(piled)15 b(and)g(then)g(immediately)f(e)o(x)o(ecuted,)g(the)h
(compiled)166 3020 y(code)25 b(can)g(be)h(immediately)e(turned)g(into)i
(Ja)n(v)n(a)f(classes)166 3120 y(using)k(the)h(Ja)n(v)n(a)g
Fl(ClassLoader)e Fn(feature.)52 b(\(That)29 b(is)166
3219 y(ho)n(w)24 b(the)g(read-e)n(v)n(al-print)d(loop)i(w)o(orks.\))36
b(An)24 b(instance)166 3319 y(of)18 b(the)f(compiled)g(sub-class)g(of)h
Fl(ModuleBody)e Fn(is)j(cre-)166 3419 y(ated)31 b(and)f
Fl(run)p Fn(,)j(which)d(normally)g(produces)f(v)n(arious)166
3518 y(side-ef)n(fects.)0 3752 y Fp(11.)99 b(T)-9 b(op-le)o(v)o(el)25
b(en)l(vir)n(onments)0 3953 y Fl(class)49 b Fm(En)m(vir)o(onment)f
Fl({)71 4053 y(...)0 4153 y(})100 4321 y Fn(An)27 b Fl(Environment)f
Fn(is)i(a)g(mapping)d(from)i(symbols)f(to)0 4420 y(bindings.)i(It)22
b(contains)f(the)h(bindings)e(of)i(the)g(user)f(top-le)n(v)o(el.)0
4520 y(There)g(can)h(be)g(multiple)f(top-le)n(v)o(el)g
Fl(Environments)p Fn(,)f(and)0 4620 y(an)28 b Fl(Environment)f
Fn(can)i(be)f(de\002ned)f(as)i(an)g(e)o(xtension)e(of)0
4719 y(an)d(e)o(xisting)f Fl(Environment)p Fn(.)34 b(The)24
b(latter)g(feature)f(is)i(used)0 4819 y(to)32 b(implement)f(the)h(v)n
(arious)f(standard)f(en)m(vironment)f(ar)o(gu-)0 4919
y(ments)e(that)g(can)g(be)g(passed)g(to)g Fl(eval)p Fn(,)h(as)g
(adopted)d(for)i(the)0 5018 y(ne)o(xt)k(Scheme)g(standard)g(re)n
(vision)g(\(\223R5RS\224\).)g(Nested)h(en-)0 5118 y(vironments)23
b(were)i(also)g(implemented)f(to)h(support)e(threads,)0
5217 y(and)d(\003uid)g(bindings)e(\(e)n(v)o(en)h(in)i(the)f(presence)f
(of)h(threads\).)0 5452 y Fp(12.)99 b(Expr)n(essions)0
5652 y Fl(class)49 b Fm(Expr)o(ession)g Fl({)71 5752
y(public)f(abstract)h(Object)f(eval)177 5852 y(\(Environment)f(env\);)
2141 510 y(public)h(abstract)h(void)g(compile)2247 609
y(\(Compilation)e(comp,)i(int)h(flags\);)2141 709 y(...)2070
809 y(})2170 981 y Fn(The)42 b(abstract)g Fl(Expression)f
Fn(class)i(represents)f(par)n(-)2070 1081 y(tially)23
b(processed)f(e)o(xpressions.)31 b(These)23 b(are)f(in)h(principle)f
(in-)2070 1181 y(dependent)e(of)i(the)g(source)g(language,)f(b)n(ut)h
(in)g(practice)g(there)2070 1280 y(are)e(some)g(Scheme)g(assumptions.)
2170 1382 y(The)29 b Fl(eval)h Fn(method)f(e)n(v)n(aluates)g(the)i
Fl(Expression)d Fn(in)2070 1481 y(the)i(gi)n(v)o(en)e
Fl(Environment)p Fn(.)52 b(The)29 b(interacti)n(v)o(e)g(command)2070
1581 y(interf)o(ace)f(uses)i Fl(eval)f Fn(to)g(e)n(v)n(aluate)f(e)o
(xpressions)g(typed)g(by)2070 1680 y(the)16 b(user)-5
b(.)24 b(Ho)n(we)n(v)o(er)m(,)14 b Fl(eval)i Fn(only)f(support)f
(\223simple\224)i(e)o(xpres-)2070 1780 y(sions,)21 b(such)f(as)i
(literals,)f(identi\002ers,)f(and)h(applications.)k(Ex-)2070
1880 y(pressions)h(that)g(de\002ne)f(ne)n(w)h(local)g(bindings)e
(\(such)i(lambda)2070 1979 y(e)o(xpressions)f(and)h Fl(let)g
Fn(forms\))g(do)g(not)g(implement)f Fl(eval)p Fn(.)2070
2079 y(If)k(the)h(user)f(types)g(in)h(such)f(an)h(e)o(xpression,)g(it)g
(is)g(wrapped)2070 2179 y(inside)e(a)h(dummy)e(function,)i(compiled,)g
(and)f(immediately)2070 2278 y(e)o(x)o(ecuted.)56 b(This)31
b(is)h(to)g(a)n(v)n(oid)e(dealing)h(with)g(le)o(xical)g(bind-)2070
2378 y(ing)g(in)h(the)g(e)n(v)n(aluator)-5 b(.)58 b(\(W)-7
b(e)32 b(could)f(compile)g Fo(all)h Fn(user)f(e)o(x-)2070
2477 y(pressions,)18 b(b)n(ut)g(that)h(entails)f(a)h(certain)f(amount)e
(of)i(o)o(v)o(erhead.)2070 2577 y(Code)h(generation)e(creates)i(ne)n(w)
g(classes,)i(and)d(JDK)i(1.0)f(does)2070 2677 y(not)h(garbage-collect)d
(unused)i(classes.\))2170 2778 y(The)24 b Fl(compile)g
Fn(method)f(is)i(called)g(when)f(we)h(are)f(com-)2070
2878 y(piling)32 b(the)h(body)e(of)h(a)h(procedure.)60
b(It)33 b(is)h(responsible)d(for)2070 2977 y(generating)23
b(bytecodes)h(that)h(e)n(v)n(aluate)f(the)h(e)o(xpression,)f(and)2070
3077 y(lea)n(v)o(e)c(the)g(result)g(on)g(the)g(Ja)n(v)n(a)h(e)n(v)n
(aluation)d(stack.)2070 3251 y Fl(class)49 b Fm(QuoteExp)g
Fl(extends)f(Expression)g({)2141 3351 y(Object)g(value;)2141
3450 y(public)g(QuoteExp\(Object)f(val\))2141 3551 y({)i(value)g(=)h
(val;)f(})2141 3650 y(public)f(Object)h(eval\(Environment)e(env\))2141
3751 y({)i(return)g(value;)g(})2141 3851 y(public)f(void)h(compile)2247
3950 y(\(Compilation)e(comp,)i(int)h(flags\))2141 4050
y({)f(comp.compileConstant)d(\(value\);)j(})2141 4150
y(...)2070 4249 y(})2170 4422 y Fn(A)37 b Fl(QuoteExp)f
Fn(represents)g(a)i(literal)f(\(self-e)n(v)n(aluating)2070
4522 y(form\),)19 b(or)g(a)i(quoted)e(form.)2070 4696
y Fl(class)49 b Fm(Refer)o(enceExp)f Fl(extends)h(Expression)f({)2141
4796 y(Symbol)g(symbol;)2141 4895 y(Declaration)f(binding;)2141
4995 y(...)2070 5094 y(})2170 5267 y Fn(A)24 b Fl(ReferenceExp)e
Fn(is)j(a)f(reference)e(to)i(a)g(named)e(v)n(ari-)2070
5367 y(able.)65 b(The)33 b Fl(symbol)g Fn(is)i(the)e(source)g(form)g
(identi\002er)-5 b(.)65 b(If)2070 5466 y Fl(binding)29
b Fn(is)i(non-null,)f(it)h(is)f(the)g(le)o(xical)g(binding)e(of)i(the)
2070 5566 y(identi\002er)-5 b(.)2070 5740 y Fl(class)49
b Fm(A)n(pplyExp)h Fl(extends)e(Expression)g({)2141 5840
y(Expression)g(func;)p eop
%%Page: 8 8
8 7 bop 71 523 a Fl(Expression[])47 b(args;)71 623 y(...)0
722 y(})100 889 y Fn(An)40 b Fl(ApplyExp)g Fn(is)i(an)f(application)e
(of)i(a)g(procedure)0 988 y Fl(func)20 b Fn(to)g(an)g(ar)o(gument)e
(list)k Fl(args)p Fn(.)0 1155 y Fl(class)49 b Fm(ScopeExp)g
Fl(extends)g(Expression)f({)71 1255 y(ScopeExp)g(outer;)h(//)g
Fo(Surr)l(ounding)18 b(scope)o(.)71 1354 y Fl(public)48
b(Declaration)g(add)p 1172 1354 25 4 v 30 w(decl)177
1454 y(\(Symbol)g(name\))71 1553 y({)h Fo(Cr)m(eate)21
b(ne)o(w)f(local)g(variable)o(.)48 b Fl(})71 1653 y(...)0
1753 y(})100 1919 y Fn(A)42 b Fl(ScopeExp)f Fn(is)j(a)e(abstract)g
(class)h(that)f(represents)0 2019 y(a)50 b(le)o(xical)g(scoping)f
(construct.)112 b(Concrete)49 b(sub-classes)0 2118 y(are)h
Fl(LetExp)f Fn(\(used)h(for)f(a)h Fl(let)g Fn(binding)f(form\))f(and)0
2218 y Fl(LambdaExp)p Fn(.)0 2385 y Fl(class)h Fm(LambdaExp)h
Fl(extends)e(ScopeExp)g({)71 2484 y(Symbol)g(name;)h(//)h
Fo(Optional.)71 2584 y Fl(Expression)e(body;)71 2684
y(int)h(min)p 425 2684 V 29 w(args;)71 2783 y(int)g(max)p
425 2783 V 29 w(args;)71 2883 y(...)0 2982 y(})100 3149
y Fn(The)23 b(Scheme)f(primiti)n(v)o(e)g(syntax)h Fl(lambda)g
Fn(is)h(translated)0 3248 y(into)e(a)g Fl(LambdaExp)p
Fn(,)f(which)h(represents)f(anon)o(ymous)e(pro-)0 3348
y(cedures.)71 b(Each)35 b Fl(LambdaExp)g Fn(is)i(compiled)d(into)i(a)g
(dif-)0 3448 y(ferent)41 b(bytecoded)e(class.)90 b(In)m(v)n(oking)39
b Fl(eval)j Fn(causes)g(the)0 3547 y Fl(LambdaExp)26
b Fn(to)i(be)f(compiled)f(into)i(a)g(class,)i(the)d(class)h(to)0
3647 y(be)d(loaded,)h(and)f(instance)g(of)g(the)g(class)i(to)e(be)g
(created,)h(and)0 3747 y(the)20 b(result)g(coerced)f(to)i(a)f
Fl(Procedure)p Fn(.)100 3846 y(Other)49 b(sub-classes)g(of)g
Fl(Expression)g Fn(are)g Fl(IfExp)0 3946 y Fn(\(used)31
b(for)f(conditional)g(e)o(xpressions\);)35 b Fl(BeginExp)30
b Fn(\(used)0 4046 y(for)21 b(compound)e(e)o(xpressions\);)i
Fl(SetExp)g Fn(\(used)h(for)f(assign-)0 4145 y(ments\);)k(and)e
Fl(ErrorExp)f Fn(\(used)h(to)h(mark)f(code)g(that)g(has)h(a)0
4245 y(syntax)c(error\);)0 4478 y Fp(13.)99 b(T)-7 b(ranslation)100
4677 y Fn(The)42 b(translation)g(phase)h(tak)o(es)g(a)h(top-le)n(v)o
(el)d(form)h(\(or)0 4777 y(body\),)30 b(and)f(generates)g(a)h
Fl(ModuleExp)p Fn(,)h(which)e(is)i(a)f(top-)0 4876 y(le)n(v)o(el)25
b(e)o(xpression.)39 b(This)26 b(is)g(done)e(using)h(a)h
Fl(Translator)p Fn(,)0 4976 y(which)19 b(k)o(eeps)g(track)f(of)h(le)o
(xical)g(bindings)f(and)h(other)f(transla-)0 5076 y(tion)i(state.)0
5242 y Fl(class)49 b Fm(T)-6 b(ranslator)48 b Fl({)71
5342 y(public)g(Expression)g(rewrite)177 5442 y(\(Object)g(exp\))71
5541 y({)h(...)h(})71 5641 y(public)e(Expression)g(syntaxError)177
5740 y(\(String)g(message\))71 5840 y({)h(...)h(})2141
523 y(...)2070 623 y(})2170 784 y Fn(The)34 b Fl(rewrite)g
Fn(method)f(con)m(v)o(erts)f(a)j(Scheme)f(source)2070
883 y(form)51 b(to)h(an)f Fl(Expression)p Fn(.)119 b(The)51
b Fl(syntaxError)2070 983 y Fn(method)24 b(is)h(called)g(when)f(a)i
(syntax)e(error)g(is)i(seen.)39 b(It)25 b(prints)2070
1083 y(out)k(the)g(current)f(source)h(\002lename)g(and)f(line)i(number)
d(with)2070 1182 y(the)20 b(gi)n(v)o(en)f Fl(message)p
Fn(.)2170 1282 y(A)h Fl(ModuleExp)f Fn(represents)h(a)g(top-le)n(v)o
(el)f(form.)2070 1443 y Fl(class)49 b Fm(ModuleExp)h
Fl(extends)e(LambdaExp)h({)2141 1543 y(public)f(Object)h(eval)p
3043 1543 V 29 w(module)2247 1642 y(\(Environment)e(env\))2141
1742 y({)2211 1842 y(if)j(\(body)p 2616 1842 V 29 w(is)p
2745 1842 V 29 w(simple\))f(//)g Fo(Optimization)2282
1941 y Fl(return)g(body.eval)f(\(env\);)2211 2041 y(Object)h(v)h(=)f
(eval)g(\(env\);)2211 2140 y(return)g(\(\(ModuleBody\))f(v\).run)g
(\(env\);)2141 2240 y(})2141 2340 y(...)2070 2439 y(})2170
2600 y(ModuleExp)27 b Fn(is)i(a)g(sub-class)g(of)f Fl(LambdaExp)p
Fn(,)h(since)2070 2700 y(it)48 b(is)g(actually)f(a)g(dummy)f(function)f
(created)i(by)f(wrap-)2070 2800 y(ping)27 b(the)g(top-le)n(v)o(el)f
(forms)h(in)h(an)g(implicit)f Fl(lambda)p Fn(.)47 b(The)2070
2899 y Fl(eval)p 2275 2899 V 29 w(module)27 b Fn(method)f(e)n(v)n
(aluates)h(the)h(top-le)n(v)o(el)e(forms.)2070 2999 y(It)16
b(in)m(v)n(ok)o(es)e(the)i Fl(eval)f Fn(in)h Fl(LambdaExp)e
Fn(\(which)h(in)m(v)n(ok)o(es)g(the)2070 3099 y(compiler\).)26
b(The)21 b(result)g(of)g Fl(eval)g Fn(is)h(a)g Fl(ModuleBody)d
Fn(\(see)2070 3198 y(section)h(9\),)g(which)f(we)i(can)f
Fl(run)p Fn(.)25 b(If)20 b(the)h Fl(body)f Fn(is)h(\223simple\224)2070
3298 y(we)29 b(don')o(t)d(bother)h(actually)g(e)n(v)n(aluating)g(the)h
Fl(ModuleExp)p Fn(,)2070 3397 y(since)23 b(that)g(entails)g(compiling)e
(it)i(to)g(a)h(bytecoded)c(class;)25 b(we)2070 3497 y(just)c
Fl(eval)f Fn(the)g Fl(body)g Fn(instead.)2070 3727 y
Fp(14.)99 b(Syntax)25 b(and)h(Macr)n(os)2070 3924 y Fl(class)49
b Fm(Syntax)f Fl({)2141 4023 y(public)g(abstract)h(Expression)f
(rewrite)2247 4123 y(\(Object)g(obj,)h(Translator)f(tr\);)2141
4223 y(...)2070 4322 y(})2170 4483 y Fn(The)18 b Fl(rewrite)h
Fn(method)f(in)h Fl(Translator)f Fn(checks)g(for)2070
4583 y(syntactic)23 b(k)o(e)o(yw)o(ords)f(and)h(macros.)35
b(If)23 b(the)h Fl(car)f Fn(of)g(a)h(\223call\224)2070
4683 y(is)31 b(a)f Fl(Syntax)f Fn(or)g(if)h(it)g(is)h(a)f
Fl(Symbol)f Fn(that)h(is)h(bound)c(to)j(a)2070 4782 y
Fl(Syntax)p Fn(,)19 b(then)h(its)h Fl(rewrite)f Fn(method)f(is)i
(called.)2170 4882 y(As)c(an)h(e)o(xample,)e(this)h(tri)n(vial)g(class)
h(implements)e Fl(quote)p Fn(.)2070 5043 y Fl(class)49
b Fm(quote)g Fl(extends)g(Syntax)f({)2141 5143 y(public)g(Expression)g
(rewrite)2247 5242 y(\(Object)g(obj,)h(Translator)f(tr\))2141
5342 y({)2211 5442 y(//)i Fo(Err)l(or)n(-c)o(hec)n(king)19
b(is)i(left)g(out.)2211 5541 y Fl(Object)49 b(value)g(=)h
(\(\(Pair\)obj\).car;)2211 5641 y(return)f(new)g(QuoteExp\(value\);)
2141 5740 y(}...)2070 5840 y(})p eop
%%Page: 9 9
9 8 bop 100 523 a Fn(Much)22 b(more)g(complicated)f(is)i(the)g
Fl(Syntax)f Fn(that)h(imple-)0 623 y(ments)d Fl(define-syntax)p
Fn(.)0 801 y Fl(class)49 b Fm(de\002ne)p 516 801 25 4
v 30 w(syntax)f Fl(extends)h(Syntax)g({)71 900 y(public)f(Expression)g
(rewrite)177 1000 y(\(Object)g(obj,)h(Translator)f(tr\))71
1100 y({)141 1199 y(enter)h(\(new)g(SyntaxRules)f(\(...\)\);)71
1299 y(})71 1399 y(...)0 1498 y(})100 1674 y Fn(The)27
b(result)h(is)i(a)e Fl(SyntaxRules)f Fn(object,)i(which)e(con-)0
1773 y(tains)18 b(an)f(encoded)e(representation)g(of)i(the)h(patterns)e
(and)h(tem-)0 1873 y(plates)22 b(in)g(the)f Fl(syntax-rules)p
Fn(.)28 b(This)22 b(is)h(in)e(its)i(o)n(wn)e(right)0
1973 y(a)g Fl(Syntax)e Fn(object.)0 2151 y Fl(class)49
b Fm(SyntaxRules)g Fl(extends)f(Syntax)h({)71 2250 y(SyntaxRule[])e
(rules;)71 2350 y(public)h(Expression)g(rewrite)177 2450
y(\(Object)g(obj,)h(Translator)f(tr\))71 2549 y({)141
2649 y(Object[])h(v)g(=)h(new)f(Object[maxVars];)141
2749 y(for)h(\(int)f(i)g(=)h(0;)f(i)h(<)g(rules.length;\))141
2848 y({)212 2948 y(SyntaxRule)e(r)i(=)f(rules[i++];)212
3047 y(if)h(\(r.match)e(\(obj,)h(v\)\))283 3147 y(return)g(r.execute)p
1087 3147 V 28 w(template\(v,)f(tr\);)141 3247 y(})141
3346 y(return)h(tr.syntaxError)212 3446 y(\("no)g(matching)g
(syntax-rule"\);)71 3546 y(})71 3645 y(...)0 3745 y(})100
3921 y Fn(Contrast)104 b(e)n(v)n(aluating)f(a)i(procedure)d
(de\002nition)0 4020 y(\()p Fl(lambda)p Fn(\),)91 b(which)77
b(causes)h(a)g(ne)n(w)g Fo(sub-class)f Fn(of)0 4120 y
Fl(Procedure)58 b Fn(to)g(be)h(created)f(and)g(compiled,)67
b(while)0 4219 y(e)n(v)n(aluating)42 b(a)i Fl(define-syntax)e
Fn(only)h(causes)h(a)h(ne)n(w)0 4319 y Fo(instance)39
b Fn(of)h Fl(SyntaxRules)f Fn(to)h(be)g(created.)84 b(This)41
b(is)0 4419 y(because)57 b(the)h Fl(syntax-rules)e Fn(can)i(be)f
(represented)0 4518 y(using)22 b(relati)n(v)o(ely)g(simple)h(and)g
(compact)f(data)g(structures.)33 b(A)0 4618 y(traditional)25
b(lo)n(w-le)n(v)o(el)h(macro)f(f)o(acility)h(speci\002es)h(the)g
(trans-)0 4718 y(formations)34 b(using)h(e)o(x)o(ecutable)f(code,)k
(and)d(that)h(probably)0 4817 y(w)o(ould)19 b(need)h(a)h(ne)n(w)f
Fl(Procedure)f Fn(sub-class.)0 5057 y Fp(15.)99 b(Code)25
b(generation)100 5263 y Fn(A)20 b Fl(Compilation)f Fn(object)g(k)o
(eeps)h(track)f(of)h(the)g(classes,)0 5363 y(methods,)29
b(and)f(temporary)e(state)j(generated)d(as)j(a)g(result)f(of)0
5463 y(compiling)18 b(a)j(single)f(top-le)n(v)o(el)f
Fl(ModuleExp)p Fn(.)0 5641 y Fl(class)49 b Fm(Compilation)g
Fl({)71 5740 y(ClassType[])e(classes;)71 5840 y(boolean)h(immediate;)
2141 510 y(public)g(ClassType)h(addClass)2247 609 y(\(LambdaExp)f
(lexp,)h(String)f(name\))2141 709 y({)h(...)h(})2141
809 y(public)e(ClassType\(ModuleExp)f(exp,)2247 908 y(...\))2141
1008 y({)i(...;)g(addClass)g(\(exp,)g(...\);)g(})2141
1108 y(...)2070 1207 y(})2170 1393 y Fn(Each)i Fl(Compilation)g
Fn(may)g(create)h(one)g(or)f(more)2070 1492 y Fl(ClassType)15
b Fn(objects,)h(each)g(of)f(which)h(generates)e(the)i(byte-)2070
1592 y(codes)31 b(for)f(one)h(class.)59 b(Each)31 b Fl(ClassType)f
Fn(is)i(generated)2070 1692 y(from)27 b(a)h Fl(LambdaExp)p
Fn(,)g(including)f(the)g(top)h Fl(ModuleExp)p Fn(.)2070
1791 y(The)f(boolean)e Fl(immediate)h Fn(is)h(true)g(if)g(we)g(are)g
(compiling)2070 1891 y(for)e(immediate)g(loading,)h(and)g(is)g(f)o
(alse)h(if)f(the)g(tar)o(get)f(is)i(one)2070 1991 y(or)20
b(more)f Fl(.class)h Fn(\002les.)2170 2095 y(The)25 b
Fl(addClass)g Fn(method)g(does)h(all)g(the)g(w)o(ork)f(to)h(com-)2070
2195 y(pile)j(a)h(gi)n(v)o(en)e Fl(LambdaExp)p Fn(.)51
b(It)29 b(creates)g(a)h Fl(ClassType)p Fn(,)2070 2294
y(adds)22 b(it)h(to)g Fl(Compilation)p Fn(')-5 b(s)21
b Fl(classes)h Fn(array)-5 b(,)22 b(and)f(gen-)2070 2394
y(erates)44 b Fl(Method)f Fn(objects)g(for)g(the)h(constructor)d(and)j
(the)2070 2494 y(main)31 b Fl(apply)p Fo(X)g Fn(method.)57
b(Once)31 b(the)g Fl(apply)p Fo(X)g Fl(Method)2070 2593
y Fn(has)k(been)f(created,)k Fl(addClass)c Fn(emits)h(some)g(bytecodes)
2070 2693 y(to)f(set)g(up)f(the)g(incoming)f(parameters,)j(and)e(then)g
(in)m(v)n(ok)o(es)2070 2792 y(the)49 b(virtual)e Fl(compile)h
Fn(method)f(on)i(the)f(body)f(of)i(the)2070 2892 y Fl(LambdaExp)p
Fn(,)30 b(which)e(generates)g(the)h(code)f(that)h(does)g(the)2070
2992 y(actual)20 b(w)o(ork)g(of)f(the)i(procedure.)2170
3096 y(The)126 b Fl(Compilation)f Fn(constructor)g(gets)i(a)2070
3196 y Fl(ModuleExp)p Fn(,)43 b(which)38 b(it)i(passes)g(to)g
Fl(addClass)p Fn(.)81 b(The)2070 3295 y Fl(compile)24
b Fn(method)f(of)i Fl(LambdaExp)f Fn(\(which)g(gets)h(called)2070
3395 y(for)41 b(all)h Fl(lambda)p Fn(s)g(e)o(xcept)e(the)i(dummy)e
(top-le)n(v)o(el\))f(also)2070 3495 y(calls)33 b Fl(addClass)e
Fn(to)h(generate)f(the)h(class)h(corresponding)2070 3594
y(to)22 b(the)h Fl(lambda)p Fn(,)e(and)h(then)g(it)h(emits)f
(instructions)f(to)i(create)2070 3694 y(a)37 b(ne)n(w)g(instance)f(of)g
(the)h(generated)e Fl(Procedure)h Fn(class,)2070 3794
y(and)20 b(pushes)f(it)i(on)f(the)g(Ja)n(v)n(a)h(stack.)2070
4041 y Fp(16.)99 b(The)26 b Fe(codegen)d Fp(package)2170
4255 y Fn(The)c Fl(ClassType)g Fn(and)g Fl(Method)g Fn(classes)i(are)f
(in)g(a)g(sep-)2070 4354 y(arate)40 b Fl(codegen)f Fn(package,)k(which)
d(is)g(an)g(intermediate-)2070 4454 y(le)n(v)o(el)35
b(interf)o(ace)f(to)h(code)f(generation)f(and)h(Ja)n(v)n(a)h
Fl(.class)2070 4554 y Fn(\002les.)66 b(It)34 b(is)h(essentially)f
(independent)d(of)i(Scheme)g(or)h(the)2070 4653 y(rest)e(of)f(Ka)o(w)o
(a,)j(and)d(could)f(be)h(used)g(for)g(generating)e(code)2070
4753 y(for)20 b(other)f(languages.)2070 4943 y Fl(class)49
b Fm(ClassT)-6 b(ype)50 b Fl(extends)e(Type)h({)2141
5043 y(CpoolEntry[])e(constant)p 3193 5043 V 29 w(pool;)2141
5143 y(Method)h(methods;)h(//)g Fo(List)22 b(of)e(methods.)2141
5242 y Fl(Field)49 b(fields;)f(//)i Fo(List)21 b(of)f(\002elds.)2141
5342 y Fl(public)48 b(Field)h(new)p 2943 5342 V 30 w(field\(String)e
(name,)2247 5442 y(Type)i(type,)g(int)g(flags\))2141
5541 y({)g Fo(Cr)m(eate)21 b(ne)o(w)f(\002eld.)49 b Fl(})2141
5641 y(public)f(method)h(new)p 2993 5641 V 29 w(method)2247
5740 y(\(String)f(name,)h(...\))2141 5840 y({)g Fo(Cr)m(eate)21
b(ne)o(w)f(method.)48 b Fl(})p eop
%%Page: 10 10
10 9 bop 71 510 a Fl(public)48 b(void)h(emit)p 873 510
25 4 v 30 w(to)p 1003 510 V 29 w(stream)177 609 y(\(OutputStream)e
(stream\))71 709 y({)i(...)h(})71 809 y(public)e(void)h(emit)p
873 809 V 30 w(to)p 1003 809 V 29 w(file)177 908 y(\(String)f
(filename\))71 1008 y({)h(...)h(})71 1107 y(public)e(byte[])h(emit)p
973 1107 V 29 w(to)p 1102 1107 V 30 w(array\(\))71 1208
y({)g(...)h(})71 1308 y(...)0 1407 y(})100 1556 y Fn(The)41
b Fl(ClassType)f Fn(class)j(is)f(the)g(main)f(class)h(of)g(the)0
1656 y Fl(codegen)26 b Fn(package.)44 b(It)27 b(manages)g(a)g(list)h
Fl(Field)p Fn(s)f(,)i(a)e(list)0 1755 y(of)h Fl(Method)p
Fn(s,)h(and)e(the)h(constant)f(pool.)47 b(There)27 b(are)h(utility)0
1855 y(methods)d(for)h(adding)e(ne)n(w)i(\002elds,)i(methods,)f(and)e
(constant)0 1955 y(pool)19 b(entries.)100 2054 y(When)39
b(the)g Fl(ClassType)g Fn(has)h(been)e(fully)h(b)n(uilt,)45
b(the)0 2154 y Fl(emit_to_file)22 b Fn(method)g(can)i(be)g(used)f(to)h
(write)g(out)g(the)0 2254 y(contents)36 b(into)g(a)h(\002le.)74
b(The)36 b(result)h(has)f(the)h(format)e(of)h(a)0 2353
y Fl(.class)22 b Fn(\002le)i([10)n(].)33 b(Alternati)n(v)o(ely)-5
b(,)22 b(the)g(class)i(can)f(be)g(writ-)0 2453 y(ten)35
b(to)g(an)g(internal)f(byte)g(array)g(\(that)h(has)g(the)g(same)g(lay-)
0 2552 y(out)h(as)g(a)h Fl(.class)e Fn(\002le\))i(using)e(the)h
Fl(emit_to_array)0 2652 y Fn(method.)62 b(The)33 b(resulting)f(byte)h
(array)f(may)h(be)g(used)f(by)h(a)0 2752 y Fl(ClassLoader)14
b Fn(to)i(de\002ne)e(a)i(ne)n(w)g(class)g(for)f(immediate)f(e)o(x-)0
2851 y(ecution.)24 b(Both)19 b(of)f(the)i(these)f(methods)f(are)h
(implemented)e(on)0 2951 y(top)j(of)g(the)g(more)f(general)g
Fl(emit_to_stream)p Fn(.)100 3051 y(The)53 b(lar)o(gest)g(class)h(in)g
(the)f Fl(codegen)g Fn(package)f(is)0 3150 y Fl(Method)p
Fn(.)0 3299 y Fl(class)d Fm(Method)g Fl({)71 3399 y(Variable)f(new)p
674 3399 V 29 w(local\(Type)g(type,)177 3498 y(String)h(name\))71
3598 y({)g(...)h(})71 3698 y(public)e(void)h(compile)p
1023 3698 V 29 w(push)p 1252 3698 V 29 w(value)177 3797
y(\(Variable)f(var\))71 3897 y({)h(...)h(})71 3996 y(public)e(void)h
(compile)p 1023 3996 V 29 w(push)p 1252 3996 V 29 w(int\(int)g(i\))71
4097 y({)g(...)h(})71 4197 y(public)e(void)h(compile)p
1023 4197 V 29 w(linenumber)177 4296 y(\(int)g(linenumber\))71
4396 y({)g(...)h(})71 4496 y(...)0 4595 y(})100 4744
y Fn(As)63 b(an)g(e)o(xample)e(of)h(the)h(le)n(v)o(el)f(of)g
(functionality)-5 b(,)0 4844 y Fl(compile_push_int)28
b Fn(compiles)h(code)h(to)g(push)g(an)g(in-)0 4943 y(te)o(ger)c
Fo(i)h Fn(on)f(stack.)45 b(It)26 b(selects)i(the)f(right)f
(instruction,)g(and)g(if)0 5043 y Fo(i)i Fn(is)g(too)f(big)f(for)h(one)
f(of)h(the)g(instructions)f(that)i(tak)o(e)f(an)g(in-)0
5143 y(line)19 b(v)n(alue,)f(it)i(will)f(create)g(a)g(constant)f(pool)h
(entry)f(for)g Fl(i)p Fn(,)h(and)0 5242 y(push)h(that.)100
5342 y(The)28 b(method)f Fl(new)p 691 5342 V 29 w(local)i
Fn(creates)f(a)h(ne)n(w)g(local)f(v)n(ari-)0 5442 y(able)j(\(and)g(mak)
o(es)g(sure)g(deb)n(ugging)e(information)g(is)j(emit-)0
5541 y(ted)27 b(for)g(it\),)i(while)e Fl(compile)p 945
5541 V 29 w(push)p 1174 5541 V 29 w(value)g Fn(pushes)g(the)0
5641 y(v)n(alue)20 b(of)f(the)i(v)n(ariable)e(on)g(the)i(stack.)100
5740 y(Ka)o(w)o(a)45 b(calls)h Fl(compile)p 890 5740
V 28 w(linenumber)e Fn(to)h(indicate)0 5840 y(that)36
b(the)g(current)f(location)g(corresponds)f(to)i(a)h(gi)n(v)o(en)d(line)
2070 523 y(number)-5 b(.)26 b(These)20 b(are)h(emitted)g(in)g(the)g
Fl(.class)48 b(file)p Fn(,)21 b(and)2070 623 y(most)32
b(Ja)n(v)n(a)h(interpreters)d(will)j(use)f(them)g(when)g(printing)e(a)
2070 722 y(stack)20 b(trace.)2070 965 y Fp(17.)99 b(Literals)2170
1175 y Fn(A)28 b(Scheme)e(quoted)g(form)h(or)g(self-e)n(v)n(aluating)e
(form)h(e)o(x-)2070 1274 y(pands)44 b(to)h(a)g Fl(QuoteExp)p
Fn(.)97 b(Compiling)43 b(a)i Fl(QuoteExp)2070 1374 y
Fn(w)o(ould)22 b(seem)h(a)g(tri)n(vial)f(e)o(x)o(ercise,)g(b)n(ut)g(it)
i(is)f(not.)32 b(There)21 b(is)j(no)2070 1474 y(w)o(ay)i(to)g(embed)f
(\(say\))h(a)g(list)h(literal)g(in)f(Ja)n(v)n(a)g(code.)42
b(Instead)2070 1573 y(we)24 b(create)g(a)h(static)f(\002eld)h(in)f(the)
g(top-le)n(v)o(el)e(class)j(for)e(a)i(each)2070 1673
y(\(dif)n(ferent\))h Fl(QuoteExp)i Fn(in)h(the)g(body)e(we)i(are)g
(compiling.)2070 1772 y(The)20 b(code)f(compiled)g(for)h(a)g
Fl(QuoteExp)f Fn(then)h(just)h(needs)e(to)2070 1872 y(load)j(the)h(v)n
(alue)f(from)g(the)h(corresponding)c(static)24 b(\002eld.)33
b(The)2070 1972 y(trick)o(y)25 b(part)h(is)h(making)e(sure)h(that)h
(the)f(static)h(\002eld)f(gets)h(ini-)2070 2071 y(tialized)19
b(\(when)f(the)h(top-le)n(v)o(el)e(class)j(is)g(loaded\))d(to)i(the)g
(v)n(alue)2070 2171 y(of)h(the)g(quoted)f(form.)2170
2274 y(The)g(basic)i(idea)f(is)h(that)f(for:)2070 2457
y Fl(\(define)49 b(\(foo\))f('\(3)i(.)f(4\)\))2170 2637
y Fn(we)20 b(compile:)2070 2821 y Fl(class)49 b Fm(f)n(oo)f
Fl(extends)h(Procedure0)f({)2141 2920 y(Object)g(static)h(lit1;)2141
3020 y(public)f(foo\(\))2141 3120 y({//)h Fo(Initializer)2211
3220 y Fl(lit1)h(=)f(new)g(Pair\(IntNum.make\(3\),)3008
3320 y(IntNum.make\(4\)\);)2141 3419 y(})2141 3519 y(public)f(Object)h
(apply0\(\))2141 3619 y({)g(return)g(lit1;)g(})2070 3719
y(})2170 3899 y Fn(When)20 b(the)g(compiled)f(class)i
Fl(foo)f Fn(is)h(loaded,)e(we)h(do:)2070 4082 y Fl(Class)49
b(fooCl)g(=)g(Class.forName\("foo"\);)2070 4182 y(Procedure)f(fooPr)h
(=)h(\(Procedure\))2141 4281 y(fooCl.newInstance)c(\(\);)2070
4481 y(//)j Fo(Using)21 b(foo:)2070 4580 y Fl(Object)49
b(result)f(=)i(fooPr.apply0)e(\(\);)2170 4860 y Fn(Ho)n(w)19
b(does)g(the)g(Ka)o(w)o(a)h(compiler)e(generate)g(the)h(appropri-)2070
4959 y(ate)31 b Fl(new)49 b(Pair)30 b Fn(e)o(xpression)f(as)j(sho)n(wn)
d(abo)o(v)o(e?)55 b(A)31 b(class)2070 5059 y(whose)f(instances)f(may)h
(appear)f(in)h(a)g(quoted)e(form)h(imple-)2070 5159 y(ments)20
b(the)g Fl(Compilable)f Fn(interf)o(ace:)2070 5342 y
Fl(interface)48 b Fm(Compilable)h Fl({)2141 5442 y(Literal)f
(makeLiteral)2247 5541 y(\(Compilation)f(comp\);)2141
5641 y(void)i(emit\(Literal)e(literal,)2247 5740 y(Compilation)h
(comp\);)2070 5840 y(})p eop
%%Page: 11 11
11 10 bop 100 523 a Fn(The)17 b Fl(makeLiteral)f Fn(creates)i(a)g
Fl(Literal)f Fn(object)g(that)0 623 y(represents)27 b(the)h(v)n(alue)g
(of)g Fl(this)f Fn(object.)48 b(That)28 b Fl(Literal)0
722 y Fn(is)23 b(later)g(passed)f(to)h Fl(emit)p Fn(,)g(which)f(emits)h
(bytecode)d(instruc-)0 822 y(tions)c(that)h(\(when)e(e)n(v)n(aluated\))
g(cause)h(a)h(v)n(alue)f(equal)f(to)i Fl(this)0 922 y
Fn(to)j(be)g(pushed)f(on)h(the)g(Ja)n(v)n(a)h(e)n(v)n(aluation)d
(stack.)100 1025 y(This)52 b(tw)o(o-part)f(protocol)g(may)g(be)h(o)o(v)
o(erkill,)59 b(b)n(ut)52 b(it)0 1124 y(mak)o(es)30 b(it)h(possible)f
(to)h(combine)e(duplicate)g(constants)h(and)0 1224 y(it)24
b(also)f(supports)g(circularly)e(de\002ned)i(constants.)33
b(\(Standard)0 1324 y(Scheme)22 b(does)g(not)f(support)g
(self-referential)g(constants,)h(b)n(ut)0 1423 y(Common)29
b(Lisp)i(does.)57 b(See)31 b(section)g(25.1.4)e Fo(Similarity)h(of)0
1523 y(Constants)20 b Fn(in)g([12)o(].\))100 1626 y(It)26
b(is)h(lik)o(ely)g(that)f(the)g Fl(Compilable)f Fn(interf)o(ace)h(will)
h(be)0 1726 y(replaced)c(in)h(the)g(future)f(with)i(the)f
(serialization)f(features)h(of)0 1825 y(JDK)d(1.1.)100
1928 y(If)35 b(we)g(are)h(compiling)d(for)i(immediate)f(e)o(x)o
(ecution,)j(we)0 2028 y(do)28 b(not)f(need)g(to)i(generate)d(code)i(to)
g(re)o(generate)e(the)i(literal.)0 2128 y(In)f(f)o(act,)h(we)f(w)o(ant)
g(to)g(re-use)f(the)h(literal)g(from)f(the)h(original)0
2227 y(source)33 b(form.)64 b(The)34 b(problem)e(is)i(passing)f(the)h
(source)f(lit-)0 2327 y(eral)24 b(to)f(the)h(byte-compiled)d(class.)36
b(T)-7 b(o)24 b(do)f(that,)i(we)f(use)g(the)0 2426 y
Fl(CompiledProc)19 b Fn(interf)o(ace.)0 2610 y Fl(interface)48
b Fm(CompiledPr)o(oc)g Fl({)71 2710 y(public)g(abstract)h(void)g
(setLiterals)177 2809 y(\(Object[])f(values\);)0 2909
y(})100 3089 y Fn(An)21 b(immediate)g(class)i(compiled)d(from)h(a)h
(top-le)n(v)o(el)f(form)0 3189 y(implements)30 b(the)h
Fl(CompiledProc)e Fn(form.)56 b(After)31 b(an)g(in-)0
3288 y(stance)24 b(of)f(the)h Fl(ModuleBody)e Fn(has)i(been)f(created,)
g(it)h(is)h(co-)0 3388 y(erced)33 b(to)g(a)h Fl(CompiledProc)p
Fn(,)h(and)e Fl(setLiterals)f Fn(is)0 3487 y(called.)d(The)21
b(ar)o(gument)e(to)i Fl(setLiterals)f Fn(is)j(an)e(array)g(of)0
3587 y(the)g(necessary)f(literal)g(v)n(alues,)h(and)f(the)g(method)g
(that)g(imple-)0 3687 y(ments)g(it)g(in)g(the)f(compiled)g(code)g
(causes)h(the)f(array)g(of)g(literal)0 3786 y(v)n(alues)k(to)g(be)g(sa)
n(v)o(ed)g(in)g(the)g Fl(ModuleBody)f Fn(instance,)h(so)h(it)0
3886 y(can)c(be)g(accessed)g(by)g(the)g(compiled)f(code.)0
4129 y Fp(18.)99 b(Lo)o(w-le)o(v)o(el)25 b(pr)n(ocedur)n(es)100
4339 y Fn(Using)c(a)i(named)e(global)g Fl(Procedure)f
Fn(object)i(has)g(a)g(bit)0 4438 y(of)29 b(o)o(v)o(erhead.)49
b(W)-7 b(e)30 b(refer)f(to)g(it)h(by)e(name,)j(and)e(\002nding)f(the)0
4538 y(right)21 b Fl(Procedure)f Fn(is)j(done)d(by)h(a)h(run)f(time)h
(name)f(lookup.)0 4638 y(Once)29 b(we)g(ha)n(v)o(e)f(the)h(procedure,)g
(we)g(do)f(a)i(virtual)e(method)0 4737 y(call)21 b(to)h(apply)e(the)h
(procedure,)d(which)i(is)i(relati)n(v)o(ely)e(f)o(ast,)i(b)n(ut)0
4837 y(we)35 b(w)o(ould)e(lik)o(e)i(to)f(be)h(able)f(to)g(inline)g(kno)
n(wn)f(functions.)0 4936 y(Also,)17 b(in)f(the)h(future,)e(we)i(w)o
(ant)f(to)g(support)f(type)h(declarations)0 5036 y(and)25
b(the)g(use)g(of)g(machine)g(types)g(such)g(as)h Fl(int)p
Fn(.)40 b(Ha)n(ving)24 b(to)0 5136 y(con)m(v)o(ert)17
b(an)h Fl(int)h Fn(to)g(an)f Fl(IntNum)g Fn(just)h(because)f(that)h(is)
h(what)0 5235 y(the)g(apply)f(interf)o(ace)h(requires)f(is)i(e)o
(xpensi)n(v)o(e.)100 5338 y(Another)33 b(problem)f(is)j(that)g(being)e
(able)h(to)h(call)f(a)h(Ja)n(v)n(a)0 5438 y(method)27
b(from)g(Scheme)h(requires)g(writing)g(by)g(hand)f(a)i(ne)n(w)0
5538 y Fl(Procedure)19 b Fn(subclass.)25 b(This)c(is)g(not)f(a)g
(friendly)f(interf)o(ace.)100 5641 y(The)44 b(plan)h(is)h(to)f(pro)o
(vide)e(ne)n(w)h(syntax)h(for)f(de\002ning)0 5740 y(Scheme)19
b(procedures)e(in)j(terms)g(of)f(Ja)n(v)n(a)h(methods.)k(The)19
b(syn-)0 5840 y(tax)h(will)h(look)f(something)e(lik)o(e:)2070
523 y Fl(\(define-virtual)47 b(exec-process)2211 623
y("java.lang.RunTime")g("exec")2211 722 y("java.lang.Process")2211
822 y(\("java.lang.String"\)\))2070 922 y(\(set!)i(ls)g(\(exec-process)
f("ls)h(-l"\)\))2170 1177 y Fn(The)31 b(primiti)n(v)o(e)g(syntax)h
Fl(define-syntax)e Fn(de\002nes)i(a)2070 1277 y Fl(PrimitiveProcedure)
19 b Fn(object)i(\(which)g(inherits)h(from)2070 1376
y Fl(PrcedureN)p Fn(\),)e(which)g(refers)h(to)g(a)h(named)e(virtual)h
(method)2070 1476 y(in)44 b(a)h(named)e(class)j(with)e(speci\002ed)g
(parameter)f(and)h(re-)2070 1576 y(turn)f(types.)94 b(The)42
b(primiti)n(v)o(es)h Fl(define-static)e Fn(and)2070 1675
y Fl(define-interface)28 b Fn(are)i(similar)m(,)i(b)n(ut)f(for)e
(static)i(and)2070 1775 y(interf)o(ace)19 b(methods.)2170
1874 y(When)37 b(the)g Fl(compile)f Fn(method)g(of)h
Fl(ApplyExp)g Fn(sees)2070 1974 y(that)20 b(the)g(function)e(is)i(a)h
Fl(PrimitiveProcedure)p Fn(,)16 b(it)21 b(will)2070 2074
y(emit)k(code)e(to)i(call)f(the)h(method.)36 b(It)24
b(will)i(also)e(emit)h(code)e(to)2070 2173 y(coerce)h(the)h(ar)o
(guments)e(to)i(the)f(required)g(types.)38 b(It)25 b(will)h(not)2070
2273 y(do)18 b(an)o(y)g(checking)f(that)h(the)h(method)e(actually)h(e)o
(xists)h(and)f(has)2070 2373 y(declared)28 b(type,)j(since)e(the)g
(method)f(may)h(not)g(be)g(a)n(v)n(ailable)2070 2472
y(yet)24 b(\(and)f(it)h(is)h(also)f(a)g(pain)f(to)h(do,)g(though)e(the)
i(JDK)h(1.1)e(re-)2070 2572 y(\003ection)d(f)o(acility)g(will)h(mak)o
(e)f(it)h(easier\).)2170 2671 y(The)i(name)h(declared)f(by)g
Fl(define-virtual)f Fn(has)j(the)2070 2771 y(same)37
b(scope)f(as)h(that)f(of)g(a)h(macro.)73 b(It)37 b(must)f(be)h(seen)f
(at)2070 2871 y(compile-time.)e(A)25 b Fl(PrimitiveProcedure)c
Fn(cannot)i(be)2070 2970 y(applied)c(or)h(called)g(at)h(top-le)n(v)o
(el)d(interacti)n(v)o(ely)-5 b(.)2170 3070 y(W)e(e)19
b(can)f(lift)g(these)g(restrictions)g(when)f(Ka)o(w)o(a)h(switches)g
(to)2070 3170 y(JDK)j(1.1)e(and)h(its)h(re\003ecti)n(v)o(e)f(features.)
k(In)c(that)g(case,)g(using)g(a)2070 3269 y Fl(PrimitiveProcedure)14
b Fn(may)i(be)h(the)g(preferred)e(w)o(ay)h(to)2070 3369
y(de\002ne)h(man)o(y)f(b)n(uiltin)g(functions.)23 b(The)17
b(adv)n(antage)e(is)j(simpler)2070 3468 y(declarations,)24
b(fe)n(wer)f(standard)g(classes,)j(much)d(f)o(aster)i(in)m(v)n(o-)2070
3568 y(cation)17 b(when)g(the)g(compiler)f(kno)n(ws)h(which)g(method)f
(is)j(being)2070 3668 y(called,)d(b)n(ut)f(at)h(the)f(cost)h(of)f(some)
n(what)f(slo)n(wer)h(calls)i(when)d(we)2070 3767 y(ha)n(v)o(e)i(to)g
(use)h(the)f(general)g Fl(applyN)f Fn(interf)o(ace,)h(which)g(w)o(ould)
2070 3867 y(use)k(the)h(probably)d(slo)n(wer)i(re\003ection)f(f)o
(acilities.)2070 4094 y Fp(19.)99 b(Continuations)2170
4289 y Fn(Scheme)28 b(continuations)f(\223capture\224)g(the)i(current)e
(e)o(x)o(ecu-)2070 4388 y(tion)k(state.)58 b(The)o(y)30
b(can)h(be)g(implemented)f(by)g(cop)o(ying)g(the)2070
4488 y(stack,)21 b(b)n(ut)f(this)h(requires)f(non-portable)d(nati)n(v)o
(e)j(code.)25 b(Ka)o(w)o(a)2070 4587 y(continuations)i(are)j
(implemented)d(using)i(Ja)n(v)n(a)g(e)o(xceptions,)2070
4687 y(and)22 b(can)g(be)h(used)f(to)h(prematurely)e(e)o(xit)h(\(thro)n
(w\),)f(b)n(ut)i(not)f(to)2070 4787 y(implement)i(co-routines)f
(\(which)h(should)f(use)j(threads)e(an)o(y-)2070 4886
y(w)o(ay\).)2070 5042 y Fl(class)49 b Fm(callcc)g Fl(extends)f
(Procedure1)g({)2141 5142 y(public)g(Object)h(apply1\(Object)f(arg1\))
2141 5242 y({)2211 5342 y(Procedure)h(proc)g(=)g(\(Procedure\))f(arg1;)
2211 5442 y(Continuation)g(cont)2282 5541 y(=)i(new)f(Continuation)f
(\(\);)2211 5641 y(try)i({)f(return)g(proc.apply1\(cont\);)d(})2211
5740 y(catch)j(\(CalledContinuation)e(ex\))2211 5840
y({)p eop
%%Page: 12 12
12 11 bop 212 523 a Fl(if)50 b(\(ex.continuation)c(!=)k(cont\))283
623 y(throw)f(ex;)g(//)h Fo(Re-thr)l(ow)-6 b(.)212 722
y Fl(return)49 b(ex.value;)141 822 y(})71 922 y(})71
1021 y(...)0 1121 y(})100 1282 y Fn(This)92 b(is)i(the)e
Fl(Procedure)g Fn(that)h(implements)0 1381 y Fl
(call-with-current-continuation)p Fn(.)258 b(It)0 1481
y(creates)44 b Fl(cont)p Fn(,)50 b(which)44 b(is)h(the)f(\223current)f
(continuation\224,)0 1581 y(and)f(passes)i(it)g(to)f(the)f(incoming)g
Fl(proc)p Fn(.)92 b(If)43 b Fl(callcc)0 1680 y Fn(catches)70
b(a)h Fl(CalledContinuation)d Fn(e)o(xception)h(it)0
1780 y(means)27 b(that)g Fl(proc)f Fn(in)m(v)n(ok)o(ed)g(some)g
Fl(Continuation)p Fn(.)44 b(If)0 1880 y(it)27 b(is)g(\223our\224)f
(continuation,)f(return)g(the)h(v)n(alue)g(passed)g(to)h(the)0
1979 y(continuation;)35 b(otherwise)c(re-thro)n(w)f(it)j(up)e(the)h
(stack)g(until)0 2079 y(we)i(get)g(a)g(matching)e(handler)-5
b(.)64 b(\(I)33 b(ha)n(v)o(e)g(left)h(out)f(code)g(to)0
2178 y(detect)25 b(unsupported)e(in)m(v)n(ocation)g(of)j
Fl(cont)f Fn(after)g Fl(callcc)0 2278 y Fn(returns.\))0
2439 y Fl(class)49 b Fm(Continuation)f Fl(extends)h(Procedure1)f({)71
2538 y(public)g(Object)h(apply1\(Object)f(arg1\))71 2639
y({)141 2739 y(throw)h(new)h(CalledContinuation)283 2838
y(\(arg1,)f(this\);)71 2938 y(})71 3038 y(...)0 3137
y(})100 3298 y Fn(A)16 b Fl(Continuation)f Fn(is)h(the)h(actual)e
(continuation)f(object)0 3398 y(that)32 b(is)h(passed)g(to)f
Fl(callcc)p Fn(')-5 b(s)32 b(ar)o(gument;)k(when)c(it)h(is)g(in-)0
3497 y(v)n(ok)o(ed,)21 b(it)h(thro)n(ws)f(a)h Fl(CalledContinuation)d
Fn(that)i(con-)0 3597 y(tains)g(the)f(continuation)e(and)h(the)h(v)n
(alue)g(returned.)0 3758 y Fl(class)49 b Fm(CalledContinuation)141
3858 y Fl(extends)g(RuntimeException)e({)71 3957 y(Object)h(value;)71
4057 y(Continuation)f(continuation;)71 4157 y
(CalledContinuation\(Object)e(value,)177 4256 y(Continuation)i
(continuation\))71 4356 y({)141 4455 y(super)i(\("call/cc)f(called"\);)
141 4555 y(this.value)g(=)i(value;)141 4655 y(this.continuation)d(=)j
(continuation;)71 4754 y(})71 4854 y(...)0 4954 y(})100
5115 y(CalledContinuation)31 b Fn(is)36 b(the)e(e)o(xception)f(that)i
(is)0 5214 y(thro)n(wn)19 b(when)g(the)i(continuation)d(is)j(in)m(v)n
(ok)o(ed.)0 5444 y Fp(20.)99 b(T)-9 b(ail-calls)100 5641
y Fn(Scheme)16 b(requires)f(that)i(tail-calls)g(be)f(implemented)f
(with-)0 5740 y(out)h(causing)f(stack)h(gro)n(wth.)23
b(This)16 b(is)h(dif)n(\002cult)e(to)i(do)e(portably)0
5840 y(in)32 b(Ja)n(v)n(a)g(\(or)f(for)g(that)h(matter)g(in)g(C\),)g
(since)g(implementing)2070 523 y(it)27 b(ef)n(\002ciently)e(requires)h
(lo)n(w-le)n(v)o(el)f(access)h(to)h(the)f(hardw)o(are)2070
623 y(stack.)39 b(There)24 b(are)g(tricks)h(one)f(can)h(use)g(\(a)f
(function)f(returns)2070 722 y(a)k(pointer)f(to)h(the)f(ne)o(xt)g
(function)g(to)g(be)h(called,)h(rather)e(than)2070 822
y(calling)19 b(it)i(directly\),)d(b)n(ut)i(these)g(are)f(rather)g(e)o
(xpensi)n(v)o(e,)f(espe-)2070 922 y(cially)i(in)h(Ja)n(v)n(a)f(\(which)
f(does)h(not)g(ha)n(v)o(e)g(function)e(pointers\).)2170
1021 y(Compiler)k(optimizations)f(can)i(re-write)f(man)o(y)g
(tail-calls)2070 1121 y(into)k Fl(goto)p Fn(s.)43 b(The)25
b(most)h(important)f(case)i(is)g(self-tail-calls)2070
1221 y(or)17 b(tail)h(recursion.)23 b(Ka)o(w)o(a)18 b(re)n(writes)f
(these)h(when)f(it)h(can)f(pro)o(v)o(e)2070 1320 y(that)23
b(is)g(safe.)32 b(It)23 b(is)g(rather)f(conserv)n(ati)n(v)o(e:)27
b(it)c(must)g(be)f(able)g(to)2070 1420 y(pro)o(v)o(e)e(that)h(the)h
(procedure)c(binding)i(cannot)h(be)g(re-assigned)2070
1520 y(to)h(some)g(other)f(v)n(alue.)29 b(Thus)22 b(only)f
Fl(letrec)g Fn(tail-recursion)2070 1619 y(is)36 b(supported,)g(not)e
(tail-recursion)g(of)g(global)g(procedures.)2070 1719
y(This)28 b(restriction)f(may)g(be)h(e)o(xcessi)n(v)o(ely)f(paranoid,)g
(b)n(ut)h(it)h(is)2070 1819 y(required)16 b(by)h(the)h(language,)e(and)
h(it)i(is)f(suf)n(\002cient)g(to)f(optimize)2070 1918
y(the)26 b(standard)e Fl(do)i Fn(and)f(named-)p Fl(let)f
Fn(forms.)41 b(A)26 b(future)e(v)o(er)n(-)2070 2018 y(sion)17
b(will)h(pro)o(vide)e(a)i(w)o(ay)f(to)g(specify)g(that)h(Ka)o(w)o(a)f
(can)g(be)g(less)2070 2117 y(conserv)n(ati)n(v)o(e)g(\(using)h(either)h
(a)h(module)e(system)h(or)g(compiler)2070 2217 y(switches\).)2170
2317 y(While)29 b(full)f(tail-call)h(elimination)e(will)j(probably)c
(ne)n(v)o(er)2070 2417 y(be)15 b(supported)e(by)i(Ka)o(w)o(a)h(\(e)o
(xcept)d(perhaps)h(on)h(modi\002ed)f(Ja)n(v)n(a)2070
2516 y(interpreters\),)29 b(some)f(forms)g(of)g(mutual)g
(tail-recursion)f(can)2070 2616 y(be)d(eliminated)f(with)h(more)f
(sophisticated)g(compiler)g(analy-)2070 2715 y(sis,)e(though)e(there)g
(are)h(no)g(concrete)f(plans)h(for)g(that)g(yet.)2070
2949 y Fp(21.)99 b(Class,)24 b(types,)h(and)h(declarations)2170
3149 y Fn(An)21 b(e)o(xtensi)n(v)o(e)f(type)h(system)g(that)h(supports)
e(user)n(-de\002ned)2070 3249 y(classes)h(is)f(important)e(for)h(e)o
(xtensibility)f(and)h(for)g(inte)o(gration)2070 3348
y(with)28 b(other)f(Ja)n(v)n(a)h(packages.)47 b(This)28
b(section)g(describes)f(cur)n(-)2070 3448 y(rent)20 b(ideas)g(for)g
(future)f(e)o(xtensions.)2170 3548 y(The)38 b(record)e(e)o(xtension)h
(proposed)g(\(and)g(rejected\))g(for)2070 3648 y(R5RS)f(will)f
(probably)d(be)j(added.)67 b(It)35 b(has)f(been)g(partially)2070
3747 y(written;)i(ho)n(we)n(v)o(er)28 b(a)j(ne)n(w)g(implementation)d
(based)i(on)h(the)2070 3847 y(JDK)22 b(1.1)e(re\003ecti)n(v)o(e)g
(features)g(seems)i(preferable,)c(since)j(that)2070 3946
y(means)26 b(the)g(record)f(accessor)h(features)g(can)g(be)g(used)g(on)
g(ar)n(-)2070 4046 y(bitrary)c(Ja)n(v)n(a)i(objects.)35
b(After)23 b(than,)h(the)f(ne)o(xt)g(step)h(is)g(to)g(add)2070
4146 y(methods,)f(and)g(we)g(ha)n(v)o(e)g(a)h(w)o(ay)f(to)h(de\002ne)e
(and)h(access)h(Ja)n(v)n(a)2070 4245 y(classes)d(from)e(Scheme.)2170
4345 y(T)-7 b(ype)19 b(declarations)g(and)h(some)g(form)g(of)g
(\002rst-class)h(types)2070 4445 y(are)35 b(also)g(planned.)67
b(This)35 b(will)g(impro)o(v)o(e)e(documentation,)2070
4545 y(error)n(-checking,)24 b(and)i(code)g(ef)n(\002cienc)o(y)-5
b(.)41 b(Among)25 b(the)i(types)2070 4644 y(to)34 b(be)f(supported)e
(are)j(\223unbox)o(ed\224)c(number)i(types,)k(so)e(the)2070
4744 y(compiler)39 b(could)h(use)h(ra)o(w)g Fl(double)f
Fn(instead)g(of)h(ha)n(ving)2070 4843 y(to)j(allocate)f(a)h
Fl(DFloNum)f Fn(object.)94 b(In)43 b(addition)g(to)g(al-)2070
4943 y(lo)n(wing)37 b(better)g(code,)42 b(this)c(feature)f(will)i(also)
f(mak)o(e)f(it)i(it)2070 5043 y(easier)i(to)g(inte)o(grate)f(with)h
(primiti)n(v)o(e)f(Ja)n(v)n(a)h(types.)87 b(\(The)2070
5142 y Fl(define-virtual)29 b Fn(syntax)h(in)h(section)g(18)g(will)g
(be)g(e)o(x-)2070 5242 y(tended)19 b(to)h(support)f(type)h(v)n
(alues.\))2170 5342 y(Some)j(kind)f(of)h(module)f(system)h(is)h
(desirable.)34 b(One)23 b(rea-)2070 5442 y(son)c(is)g(to)g(control)f
(names)g(and)h(names)f(clashes;)i(another)d(rea-)2070
5541 y(son)g(is)i(so)f(that)g(the)f(compiler)f(can)i(map)f(global)f(v)n
(ariables)h(ref-)2070 5641 y(erences)25 b(to)g(their)g(de\002nitions.)
39 b(This)25 b(mak)o(es)g(it)h(easier)g(to)f(do)2070
5740 y(better)f(optimizations.)36 b(It)25 b(is)g(tempting)f(to)g
(de\002ne)g(a)h(module)2070 5840 y(as)h(a)f(kind)f(of)h(class:)35
b(A)26 b(simple)e(module)g(is)i(a)f(packaging)e(of)p
eop
%%Page: 13 13
13 12 bop 0 523 a Fn(data)17 b(and)f(function)g(de\002nitions,)g(and)h
(it)h(is)g(easy)f(to)g(map)f(these)0 623 y(into)30 b(static)h(\002elds)
g(and)f(methods)g(of)g(a)h(class.)56 b(Controlling)0
722 y(which)19 b(components)e(are)i(e)o(xported)e(is)j(similar)g(to)f
(specifying)0 822 y(visibility)j(\()p Fl(public)g Fn(or)g
Fl(private)p Fn(\).)30 b(What)23 b(is)g(more)f(chal-)0
922 y(lenging)g(is)i(ho)n(w)f(to)g(model)g(import)f(lists,)j(or)e
(module)f(signa-)0 1021 y(ture/interf)o(aces.)g(Perhaps)15
b(we)h(can)f(use)h(Ja)n(v)n(a)f(interf)o(ace)g(types.)100
1121 y(Gi)n(v)o(en)33 b(all)j(this)f(ne)n(w)f(infrastructure)f(\(types)
h(and)g(mod-)0 1220 y(ules\),)25 b(then)e(the)i(compiler)d(will)j(need)
f(some)g(re-writing.)35 b(At)0 1320 y(the)d(v)o(ery)f(least)i(it)g
(needs)f(to)g(kno)n(w)f(that)h(e)o(xpressions)f(may)0
1420 y(ha)n(v)o(e)20 b(other)f(types)h(than)g(just)g(plain)g
Fl(Object)p Fn(.)0 1645 y Fp(22.)99 b(Curr)n(ent)27 b(and)e(Futur)n(e)i
(W)-7 b(ork)100 1837 y Fn(There)24 b(is)j(v)o(ery)d(preliminary)f
(threads)i(support)f(in)i(Ka)o(w)o(a.)0 1936 y(It)19
b(pro)o(vides)d(an)j(interf)o(ace)e(to)i(Ja)n(v)n(a)g(threads)f(that)g
(looks)g(some-)0 2036 y(what)31 b(lik)o(e)g Fl(delay)p
Fn(,)h(e)o(xcept)e(that)h(the)g(delayed)e(e)o(xpression)0
2135 y(is)35 b(e)n(v)n(aluated)e(in)h(a)g(ne)n(w)g(thread.)66
b(\(The)33 b(model)g(is)i(similar)0 2235 y(to)c(to)h(the)f
(\223futures\224)f(concept)g(of)h(MultiScheme)f([11)o(],)k(b)n(ut)0
2335 y(there)j(is)i(no)f(implicit)g(force,)j(at)d(least)h(yet.\))78
b(Recent)38 b(re-)0 2434 y(implementation)25 b(of)i(core)f(classes)j
(\(such)d Fl(Environment)0 2534 y Fn(and)i Fl(Translator)p
Fn(\))e(has)j(been)f(done)f(to)h(support)f(threads)0
2634 y(with)20 b(optionally)f(separate)h(top-le)n(v)o(el)e(en)m
(vironments.)100 2733 y(An)34 b(interf)o(ace)f(to)h(graphics)e(primiti)
n(v)o(es)h(is)i(needed,)h(b)n(ut)0 2833 y(no)21 b(w)o(ork)h(has)g(been)
f(done.)29 b(Unfortunately)-5 b(,)19 b(Ja)n(v)n(a')-5
b(s)23 b(Abstract)0 2932 y(W)m(indo)n(wing)16 b(T)-7
b(oolkit)16 b(is)j(commonly)c(considered)h(among)g(the)0
3032 y(weak)o(er)h(parts)h(of)f(Ja)n(v)n(a,)h(and)g(lacks)f(important)g
(features,)g(such)0 3132 y(as)k(a)g(decent)e(multi-line)g(te)o(xt)h
(editor)-5 b(.)100 3231 y(More)41 b(sophisticated)g(Scheme)g(code)g(re)
n(writing,)46 b(opti-)0 3331 y(mizations,)17 b(and)g(inlining)f(should)
h(also)g(be)h(in)m(v)o(estigated)d(after)0 3431 y(Ka)o(w)o(a)j(has)h
(been)e(taught)h(to)g(kno)n(w)f(about)h(types)g(as)h(discussed)0
3530 y(in)h(section)g(21.)100 3630 y(One)30 b(important)e(goal)h(of)h
(Ka)o(w)o(a)g(is)h(that)f(it)h(should)e(sup-)0 3729 y(port)38
b(multiple)f(languages.)78 b(This)39 b(includes)e(an)h(interf)o(ace)0
3829 y(to)43 b(plug)f(in)h(ne)n(w)g(parsers,)k(pre-de\002ned)41
b(functions,)47 b(data)0 3929 y(types,)26 b(and)e(output)g(formatting.)
38 b(Of)25 b(special)g(interest)g(is)h(re-)0 4028 y(implementing)i
(some)j(of)f(the)g(ideas)h(and)f(syntax)f(from)h(my)0
4128 y(earlier)f(Q)i(language)d([1)o(].)54 b(These)30
b(include)f(a)h(line-oriented)0 4228 y(syntax)18 b(with)g(fe)n(wer)g
(parentheses,)f(and)h(high-le)n(v)o(el)e(sequence)0 4327
y(and)k(array)f(operations)g(\(as)h(in)g(APL\).)100 4427
y(Also)35 b(of)g(interest)g(is)i(support)c(for)i(Emacs)g(Lisp.)70
b(This)0 4526 y(w)o(ould)36 b(require)f(an)h(e)o(xtensi)n(v)o(e)f
(library)g(to)h(implement)g(the)0 4626 y(Emacs)19 b(data)g(types)g
(\(such)g(as)h(b)n(uf)n(fers)e(and)h(windo)n(ws\),)f(in)h(ad-)0
4726 y(dition)j(to)g(the)h(challenges)e(of)h(the)h(Emacs)f(Lisp)h
(language)d(it-)0 4825 y(self)k(\(it)f(has)h(dif)n(ferent)d(data)i
(types)g(and)g(name)f(binding)g(rules)0 4925 y(than)h(Scheme\),)h(b)n
(ut)g(may)f(be)h(a)g(good)f(w)o(ay)h(to)g(b)n(uild)f(a)i(ne)o(xt-)0
5025 y(generation)18 b(Emacs.)0 5250 y Fp(23.)99 b(Conclusion)100
5442 y Fn(Ja)n(v)n(a)18 b(is)h(a)f(solid)h(implementation)c(of)j
(Scheme)g(with)g(man)o(y)0 5541 y(features.)72 b(It)36
b(is)h(portable)d(to)j(an)o(y)e(en)m(vironment)e(that)j(can)0
5641 y(run)30 b(Ja)n(v)n(a)i(applications.)56 b(It)31
b(has)h(acti)n(v)o(e)e(use)h(and)g(de)n(v)o(elop-)0 5740
y(ment.)23 b(I)16 b(ha)n(v)o(e)f(not)g(bothered)f(running)f
(benchmarks,)h(because)0 5840 y(the)31 b(state)h(of)f(the)g(art)g(in)g
(Ja)n(v)n(a)h(implementation)d(is)j(in)f(such)2070 523
y(\003ux,)22 b(because)g(man)o(y)f(optimizations)f(are)i(planned)f(b)n
(ut)h(ha)n(v)o(e)2070 623 y(not)30 b(been)f(implemented,)h(and)f
(because)h(the)g(dif)n(ferent)e(fea-)2070 722 y(ture)18
b(sets)i(of)f(the)g(v)n(arious)f(Scheme)g(implementations)f(mak)o(es)
2070 822 y(them)23 b(dif)n(\002cult)f(to)i(compare)d(f)o(airly)-5
b(.)33 b(But)24 b(Ka)o(w)o(a)f(has)g(the)g(po-)2070 922
y(tential)33 b(of)f(being)f(a)i(reasonably)d(f)o(ast)j(Scheme)f
(implemen-)2070 1021 y(tation)24 b(\(though)e(probably)g(ne)n(v)o(er)g
(among)h(the)h(v)o(ery)f(f)o(astest\),)2070 1121 y(and)d(will)h(reap)f
(bene\002ts)h(from)e(current)g(ef)n(forts)h(in)h(Ja)n(v)n(a)f(com-)2070
1220 y(pilation)f([2].)2070 1440 y Fp(Refer)n(ences)2121
1619 y Fd([1])42 b(P)-8 b(.)22 b(Bothner)l(.)41 b Fc(Ef)o(\002ciently)
23 b(Combining)i(Lo)o(gical)e(Constr)o(aints)2250 1710
y(with)h(Functions)p Fd(.)46 b(PhD)24 b(thesis,)h(Department)h(of)e
(Computer)2250 1802 y(Science,)19 b(Stanford)g(Uni)n(v)o(ersity)-5
b(,)19 b(1988.)2121 1883 y([2])42 b(P)-8 b(.)16 b(Bothner)l(.)24
b(A)17 b(Gcc-based)h(Ja)o(v)n(a)g(implementation.)24
b(In)17 b Fc(IEEE)2250 1974 y(Compcon)j(1997)g(Pr)m(oceedings)g(\(to)f
(appear\))p Fd(,)g(1997.)2121 2055 y([3])42 b(T)-6 b(.)19
b(A.)g(Budd.)30 b(Generalized)20 b(arithmetic)f(in)h(C++.)29
b Fc(J)n(ournal)21 b(of)2250 2146 y(Object-Oriented)e(Pr)m(o)o(gr)o
(amming)p Fd(,)h(3\(6\):11\22622,)g(Feb)m(.)e(1991.)2121
2227 y([4])42 b(W)-7 b(.)15 b(Clinger)h(and)h(J.)f(Rees.)21
b(Re)n(vised)3199 2195 y Fb(4)3250 2227 y Fd(report)c(on)f(the)h
(algorith-)2250 2318 y(mic)h(language)i(Scheme.)26 b
Fc(LISP)18 b(P)-6 b(ointer)o(s)p Fd(,)18 b(4\(3\):1\22655,)i(1991.)2121
2399 y([5])42 b(J.)23 b(Gosling,)i(B.)e(Jo)o(y)-5 b(,)25
b(and)g(G.)e(Steele.)41 b Fc(The)24 b(J)m(ava)h(Langua)o(g)o(e)2250
2491 y(Speci\002cation)p Fd(.)j(Addison-W)-6 b(esle)o(y)h(,)20
b(1996.)2121 2572 y([6])42 b(T)-6 b(.)24 b(Granlund.)47
b Fc(The)24 b(GNU)h(Multiple)f(Pr)m(ecision)i(Arithmetic)2250
2663 y(Libr)o(ary)p Fd(,)19 b(2.0.2)h(edition,)g(June)g(1996.)31
b(\()p Fa(Gmp)19 b Fd(and)h(its)f(manual)2250 2754 y(are)g(a)o(v)n
(ailable)g(on)g(most)g(GNU)g(archi)n(v)o(es.\).)2121
2835 y([7])42 b(D.)34 b(H.)g(H.)g(Ingalls.)77 b(A)34
b(simple)h(technique)h(for)e(handling)2250 2927 y(multiple)45
b(polymorphism.)115 b Fc(A)n(CM)45 b(SIGPLAN)f(Notices)p
Fd(,)2250 3018 y(21\(11\):347\226349,)22 b(No)o(v)-5
b(.)20 b(1986.)30 b(OOPSLA)18 b('86)i(Conference)2250
3109 y(Proceedings,)36 b(Norman)d(Me)o(yro)n(witz)f(\(editor\),)j
(September)2250 3201 y(1986,)20 b(Portland,)e(Ore)o(gon.)2121
3282 y([8])42 b(International)18 b(Standards)g(Or)o(ganization.)24
b Fc(SGML)17 b(\(Standar)m(d)2250 3373 y(Gener)o(alized)j(Markup)g
(Langua)o(g)o(e\))h(ISO)e(8879)p Fd(.)2121 3454 y([9])42
b(International)24 b(Standards)h(Or)o(ganization.)43
b Fc(Document)25 b(Style)2250 3545 y(Semantics)e(and)g(Speci\002cation)
i(Langua)o(g)o(e)p Fd(,)g(1996.)40 b(Interna-)2250 3636
y(tional)19 b(Standard)g(ISO/IEC)e(10179:1996\(E\).)2084
3717 y([10])42 b(T)-6 b(.)24 b(Lindholm)i(and)f(F)-6
b(.)24 b(Y)-7 b(ellin.)46 b Fc(The)25 b(J)m(ava)h(V)-6
b(irtual)25 b(Mac)o(hine)2250 3809 y(Speci\002cation)p
Fd(.)j(Addison-W)-6 b(esle)o(y)h(,)20 b(1996.)2084 3890
y([11])42 b(J.)23 b(S.)f(Miller)l(.)41 b Fc(MultiSc)o(heme:)34
b(A)22 b(P)-6 b(ar)o(allel)24 b(Pr)m(ocessing)g(Sys-)2250
3981 y(tem)30 b(based)h(on)f(MIT)g(Sc)o(heme)p Fd(.)63
b(PhD)30 b(thesis,)i(Department)2250 4072 y(of)21 b(Electrical)g
(Engineering)i(and)f(Computer)g(Science,)g(MIT)-6 b(,)2250
4164 y(Aug.)19 b(1987.)28 b(MIT)-7 b(-LCS//MIT/LCS/TR-402.)2084
4245 y([12])42 b(G.)19 b(L.)f(Steele)h(Jr)l(.)28 b Fc(Common)20
b(Lisp)e(\226)i(The)f(Langua)o(g)o(e)p Fd(.)30 b(Digital)2250
4336 y(Press)15 b(and)g(Prentice-Hall,)g(12)h(Crosby)g(Dri)n(v)o(e,)f
(Bedford,)i(MA)2250 4427 y(01730,)32 b(USA)c(and)h(Engle)n(w)o(ood)h
(Clif)n(fs,)g(NJ)f(07632,)j(USA,)2250 4519 y(second)20
b(edition,)f(1990.)2070 4739 y Fp(Biographical)25 b(Inf)n(ormation)2170
4925 y Fm(P)n(er)39 b Fn(Magnus)g(Alfred)f Fm(Bothner)i
Fn(studied)f(at)g(the)h(Uni-)2070 5025 y(v)o(ersity)f(of)g(Oslo,)44
b(Norw)o(ay)-5 b(,)42 b(and)d(recei)n(v)o(ed)f(his)h(Ph.D.)g(in)2070
5125 y(Computer)30 b(Science)i(from)f(Stanford)f(Uni)n(v)o(ersity)g(in)
i(1989.)2070 5224 y(He)d(then)g(w)o(ork)o(ed)f(for)g(Digital)i
(Equipment;)h(Uni)n(v)o(ersity)d(of)2070 5324 y(W)m(isconsin;)46
b(and)37 b(has)g(w)o(ork)o(ed)f(for)h(Cygnus)g(since)g(1991.)2070
5424 y(He)26 b(can)f(be)g(reached)g(at)h Fl(<bothner@cygnus.com>)c
Fn(or)2070 5523 y Fl(<bothner@gnu.ai.mit.edu>)p Fn(.)2170
5623 y(His)53 b(highly)e(unimpressi)n(v)o(e)f(home)i(page)g(is)h
Fl(http:)2070 5722 y(//www.cygnus.com/\230bothner)p Fn(,)e(b)n(ut)d(at)
g(least)h(it)2070 5822 y(tells)21 b(you)e(where)h(to)g(get)h(Ka)o(w)o
(a.)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
