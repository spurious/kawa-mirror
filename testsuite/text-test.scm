;; -*- coding: utf-8 -*-

(test-begin "text")

(test-equal #\space (integer->char 32))
(test-equal 5000 (char->integer (integer->char 5000)))
;; If strict:
;; (test-error (integer->char #\xD800)   )
(test-equal #t (char<? #\z #\))
(test-equal #f (char<? #\z #\Z))
(test-equal #t (string<? "z" ""))
(test-equal #t (string<? "z" "zz"))
(test-equal #f (string<? "z" "Z"))

(test-equal #f (string=? "Stra른" "Strasse"))

(test-equal #\I (char-upcase #\i))
(test-equal #\i (char-downcase #\i))
(test-equal #\I (char-titlecase #\i))
(test-equal #\i (char-foldcase #\i))
(test-equal #\ (char-upcase #\))
(test-equal #\ (char-downcase #\))
(test-equal #\ (char-titlecase #\))
(test-equal #\ (char-foldcase #\))
(test-equal #\풖 (char-upcase #\풖))
(test-equal #\픢 (char-downcase #\풖))
(test-equal #\풖 (char-titlecase #\풖))
(test-equal #\픢 (char-foldcase #\풖))
(test-equal #\풖 (char-upcase #\픡))
(test-equal #\픡 (char-downcase #\픡))
(test-equal #\풖 (char-titlecase #\픡))
(test-equal #\픢 (char-foldcase #\픡))

(test-equal #t (char-alphabetic? #\a))
(test-equal #t (char-numeric? #\1))
(test-equal #t (char-whitespace? #\space))
(test-equal #t (char-whitespace? #\x00A0))
(test-equal #t (char-upper-case? #\풖))
(test-equal #t (char-lower-case? #\픢))
(test-equal #t (char-lower-case? #\x00AA))
(test-equal #f (char-title-case? #\I))
(test-equal #t (char-title-case? #\x01C5))

(test-equal 'Ll (char-general-category #\a))
(test-equal 'Zs (char-general-category #\space))
(test-equal 'Cn (char-general-category #\x10FFFF))

(test-equal "HI" (string-upcase "Hi"))
(test-equal "hi" (string-downcase "Hi"))
(test-equal "hi" (string-foldcase "Hi"))
(test-equal "STRASSE" (string-upcase "Stra른"))
(test-equal "stra른" (string-downcase "Stra른"))
(test-equal "strasse" (string-foldcase "Stra른"))
(test-equal "strasse" (string-downcase "STRASSE"))
(test-equal "픢" (string-downcase "풖"))
(test-equal "풚품풖" (string-upcase "풚품풖"))
(test-equal "픦풤픡" (string-downcase "풚품풖"))
(test-equal "픦풤픢픡" (string-downcase "풚품풖풖"))
(test-equal "픦풤픡 픢" (string-downcase "풚품풖 풖"))
(test-equal "픦풤픢픡" (string-foldcase "풚품풖풖"))
(test-equal "풚품풖" (string-upcase "픦풤픡"))
(test-equal "풚품풖" (string-upcase "픦풤픢"))
(test-equal "Knock Knock" (string-titlecase "kNock KNoCK"))
(test-equal "Who's There?" (string-titlecase "who's there?"))
(test-equal "R6rs" (string-titlecase "r6rs"))
(test-equal "R6rs" (string-titlecase "R6RS"))
(test-expect-fail 1)
(test-equal "If\xFB01; Flat Fire"
	    (string-titlecase "if\xFB01; \xFB02;at \xFB01;re"))

(test-equal #f (string-ci<? "z" "Z"))
(test-equal #t (string-ci=? "z" "Z"))
(test-equal #t (string-ci=? "Stra른" "Strasse"))
(test-equal #t (string-ci=? "Stra른" "STRASSE"))
(test-equal #t (string-ci=? "풚품풖" "픦풤픢"))

(cond-expand (string-normalize-unicode)
             (else
              (test-expect-fail 4)))
(test-equal "\x65;\x301;" (string-normalize-nfd "\xE9;"))
(test-equal "\xE9;" (string-normalize-nfc "\xE9;"))
(test-equal "\x65;\x301;" (string-normalize-nfd "\x65;\x301;"))
(test-equal "\xE9;" (string-normalize-nfc "\x65;\x301;"))

(define str1 "a游땍b游떂c")
(test-equal 5 (string-length str1))
(test-equal #\c (string-ref str1 4))
(test-equal #\游떂 (string-ref str1 3))
(define str1lst '())
(string-for-each (lambda (x)
                   (set! str1lst (cons (char->integer x) str1lst)))
                 str1)
(test-equal '(97 128514 98 128572 99) (reverse str1lst))

(define str2lst '())
(string-for-each (lambda (x y)
                   (set! str2lst (cons (char->integer x) str2lst))
                   (set! str2lst (cons (char->integer y) str2lst)))
                 str1 "ABC")
(test-equal '(97 65 128514 66 98 67) (reverse str2lst))

(define str3lst '())
;; SRFI-13 extension
(string-for-each (lambda (x)
                   (set! str3lst (cons (char->integer x) str3lst)))
                 str1 1 4)
(test-equal '(128514 98 128572) (reverse str3lst))

(import (srfi :13 strings))
(test-equal 15 (string-contains "eek -- what a geek." "ee" 12 18))

;;; Test SRFI-13 string-append/shared
(let ((str "abc"))
  (test-equal "" (string-append/shared))
  (test-equal "" (string-append/shared ""))
  (test-equal "abc" (string-append/shared str))
  (set! str (string-append/shared str "123" "xy"))
  (test-equal "abc123xy" (string-append/shared str))
  (test-equal "abc123xy" str))

(test-end)
